<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>é«”é©—è©³æƒ… - Local Friends Taiwan | å°ç£åœ¨åœ°é€£ç·š</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI","Microsoft JhengHei",sans-serif;line-height:1.6;color:#2D6A4F;background:#F7F5F2}

    /* æµ®å‹•å°è¦½åˆ— */
    .floating-nav{position:fixed;left:20px;top:50%;transform:translateY(-50%);z-index:1000;background:#fff;padding:1rem;border-radius:30px;box-shadow:0 4px 20px rgba(45,106,79,.2);border:2px solid #2D6A4F}
    .floating-nav a{display:block;width:50px;height:50px;margin:.5rem 0;border-radius:50%;background:linear-gradient(135deg,#2D6A4F,#40916C);color:#fff;text-decoration:none;display:flex;align-items:center;justify-content:center;font-size:1.5rem;transition:.3s}
    .floating-nav a:hover{transform:scale(1.1);background:linear-gradient(135deg,#40916C,#52B788)}

    /* å›é ‚ */
    .back-to-top{position:fixed;right:30px;bottom:30px;width:60px;height:60px;background:linear-gradient(135deg,#F4845F,#F4A261);color:#fff;border:none;border-radius:50%;font-size:1.5rem;cursor:pointer;box-shadow:0 4px 20px rgba(244,132,95,.4);display:none;z-index:999;transition:.3s}
    .back-to-top:hover{transform:translateY(-5px)}
    .back-to-top.show{display:flex;align-items:center;justify-content:center}

    /* Heroï¼šé«˜åº¦å›ºå®š */
    .hero-section{
      position:relative;height:42vh;min-height:240px;max-height:480px;
      display:flex;align-items:center;justify-content:center;text-align:center;
      overflow:hidden;background:#2D6A4F
    }

    /* å½±åƒèƒŒæ™¯å®¹å™¨ */
    .hero-media{position:absolute;inset:0;z-index:1}

    /* æ¡Œæ©Ÿï¼šä¸‰å¼µä¸¦æ’ï¼ˆä¸è¼ªæ’­ã€å®Œå…¨å¡«æ»¿ï¼‰ */
    .hero-grid{width:100%;height:100%;display:grid;grid-template-columns:repeat(3,1fr);gap:0}
    .hero-grid-item{position:relative;background:#2D6A4F}
    .hero-grid-item img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;object-position:center;display:block}

    /* æ‰‹æ©Ÿï¼šå–®å¼µè¼ªæ’­ */
    .hero-carousel{display:none;position:absolute;inset:0}
    .hero-slide{position:absolute;inset:0;opacity:0;transition:opacity .6s ease;background:#2D6A4F}
    .hero-slide.active{opacity:1}
    .hero-slide img{position:absolute;inset:0;width:100%;height:100%;object-fit:cover;object-position:center;display:block}

    /* æ¼¸å±¤ç–ŠåŠ ï¼šä¸Šæ–¹è¼ƒæ·±ã€å¾€ä¸‹æ¼¸æ·¡ï¼ˆæå‡æ–‡å­—å¯è®€æ€§ï¼‰ */
    .hero-overlay{
      position:absolute;inset:0;z-index:2;
      background:linear-gradient(
        to bottom,
        rgba(45,106,79,0.82) 0%,
        rgba(45,106,79,0.62) 28%,
        rgba(45,106,79,0.42) 55%,
        rgba(45,106,79,0.28) 100%
      );
      pointer-events:none;
    }

    /* Hero æ–‡å­—ï¼šèˆ‡ä¸Šã€ä¸‹ç·£éƒ½ç•™ç©ºé–“ */
    .hero-content{
      position:relative;z-index:3;color:#fff;max-width:1100px;
      padding:1.25rem clamp(22px,5vw,32px);
      margin-top:clamp(24px,6vh,72px);     /* èˆ‡é ‚ç«¯ç•™è· */
      margin-bottom:clamp(16px,6vh,64px);  /* âœ… èˆ‡åº•éƒ¨ä¹Ÿç•™è·ï¼ˆé¿å… tag è²¼åº•ï¼‰ */
    }
    .hero-content h1{
      font-size:3rem;font-weight:900;margin-bottom:.5rem;line-height:1.15;
      text-shadow:0 3px 10px rgba(0,0,0,.45),0 8px 24px rgba(0,0,0,.35);letter-spacing:.3px
    }
    .hero-content .subtitle{font-size:1.5rem;margin-bottom:.9rem;opacity:.98;text-shadow:0 2px 8px rgba(0,0,0,.35)}
    .hero-content .description{font-size:1.15rem;margin-bottom:1.2rem;line-height:1.75;opacity:.95;text-shadow:0 2px 8px rgba(0,0,0,.35)}

    /* Tagï¼šå–®è¡Œï¼‹å°å°ºå¯¸ï¼Œå¯æ°´å¹³æ²å‹• */
    .hero-tags{
      display:flex;gap:.5rem;justify-content:center;align-items:center;
      flex-wrap:nowrap;overflow-x:auto;overflow-y:hidden;
      -webkit-overflow-scrolling:touch;scrollbar-width:none
    }
    .hero-tags::-webkit-scrollbar{display:none}
    .hero-tag{
      padding:.4rem .8rem;
      background:rgba(255,255,255,.22);
      backdrop-filter:blur(8px);
      border:2px solid rgba(255,255,255,.35);
      border-radius:18px;
      color:#fff;font-size:.92rem;font-weight:700;
      white-space:nowrap;
    }

    /* å…§å®¹èˆ‡å¡ç‰‡ */
    .container{max-width:1200px;margin:0 auto;padding:3rem 2rem}
    .content-section{background:#fff;padding:3rem;border-radius:15px;margin-bottom:2rem;border:3px solid #E9C46A;box-shadow:0 4px 20px rgba(233,196,106,.2)}
    .content-section h2{font-size:2rem;color:#2D6A4F;margin-bottom:1.2rem;font-weight:800;border-bottom:3px solid #E9C46A;padding-bottom:.5rem}
    .content-section h3{font-size:1.5rem;color:#2D6A4F;margin:2rem 0 1rem;font-weight:700}
    .content-section p{font-size:1.2rem;color:#555;line-height:1.9;margin-bottom:1.2rem}

    .info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:2rem;margin-top:1.2rem}
    .info-item{background:#F7F5F2;padding:1.6rem;border-radius:12px;border:2px solid #E9C46A}
    .info-item h4{font-size:1.2rem;color:#2D6A4F;margin-bottom:.8rem;font-weight:800}
    .info-item p{font-size:1.05rem;margin-bottom:.4rem}
    .info-item a{color:#F4845F;text-decoration:none;font-weight:700;word-break:break-all}
    .info-item a:hover{text-decoration:underline}

    /* Doc å…§å®¹å‘ˆç¾ */
    .doc-render{padding:0}
    .doc-render-inner{
      padding:2rem 2rem;max-width:900px;margin:0 auto;
      overflow-x:hidden; /* é˜²æ­¢å¥‡æ€ªçš„å¤–æº¢é€ æˆæ•´é æ°´å¹³æ²å‹• */
    }
    .doc-render-inner h2{font-size:2rem;color:#2D6A4F;margin-bottom:1.2rem;font-weight:800;border-bottom:3px solid #E9C46A;padding-bottom:.5rem}
    .doc-render-inner h1,.doc-render-inner h2 + h3,.doc-render-inner h3,.doc-render-inner h4{line-height:1.3;margin:1.2rem 0 .6rem;color:#1f4d39;font-weight:800}
    .doc-render-inner p{margin:.8rem 0;color:#2f2f2f;font-size:1.06rem}
    .doc-render-inner strong{font-weight:800}
    .doc-render-inner ul,.doc-render-inner ol{margin:.8rem 0 .8rem 1.25rem}
    .doc-render-inner li{margin:.35rem 0}
    .doc-render-inner blockquote{border-left:4px solid #E9C46A;background:#FFF9E6;padding:.8rem 1rem;border-radius:8px;color:#2e2e2e;margin:1rem 0}

    /* âœ… åœ–ç‰‡æ°¸ä¸è¶…æ¡†ï¼›åœ–è¡¨ï¼ˆtableï¼‰å¯æ©«å‘æ²å‹• */
    .doc-render-inner img{max-width:100% !important;height:auto !important;display:block;margin:1rem auto;border-radius:8px;box-shadow:0 2px 12px rgba(0,0,0,.06)}
    .doc-render-inner figure{max-width:100% !important;margin:1rem 0;overflow-x:auto}
    .doc-render-inner .table-scroll{overflow-x:auto;-webkit-overflow-scrolling:touch}
    .doc-render-inner table{width:max-content;border-collapse:collapse;margin:1rem 0;display:table}
    .doc-render-inner thead th,.doc-render-inner th,.doc-render-inner td{border:1px solid #e6e6e6;padding:.6rem .8rem;text-align:left;vertical-align:top;white-space:nowrap}
    .doc-render-inner thead th{background:#f7f7f7;font-weight:800}
    .doc-render-inner iframe{max-width:100% !important;width:100% !important;border:0;border-radius:8px;min-height:300px;box-shadow:0 2px 12px rgba(0,0,0,.06)}

    .doc-render .loading-line{height:10px;border-radius:6px;background:linear-gradient(90deg,#e9f3ee,#f3faf7,#e9f3ee);background-size:200% 100%;animation:shimmer 1.2s infinite}
    @keyframes shimmer{0%{background-position:0 0}100%{background-position:200% 0}}

    /* åœ°åœ– */
    .map-section{background:#fff;padding:2rem;border-radius:15px;border:3px solid #E9C46A;box-shadow:0 4px 20px rgba(233,196,106,.2);margin-bottom:2rem}
    .map-section h2{font-size:2rem;color:#2D6A4F;margin-bottom:1rem;font-weight:800}
    .map-address{font-size:1.1rem;color:#555;margin-bottom:1.2rem;padding:.9rem 1rem;background:#F7F5F2;border-radius:8px;border-left:4px solid #E9C46A}
    .map-container{width:100%;height:450px;border-radius:12px;overflow:hidden;box-shadow:0 4px 15px rgba(45,106,79,.15)}
    .map-container iframe{width:100%;height:100%;border:0}

    /* CTA */
    .cta-section{background:linear-gradient(135deg,#2D6A4F,#40916C);color:#fff;padding:3rem;border-radius:15px;text-align:center;box-shadow:0 4px 20px rgba(45,106,79,.3)}
    .cta-section h2{font-size:2.2rem;margin-bottom:1rem;font-weight:800;text-wrap:balance}
    .cta-section p{font-size:1.2rem;margin-bottom:2rem;opacity:.95;text-wrap:balance;word-break:keep-all}
    .btn{display:inline-block;padding:1rem 1.6rem;background:linear-gradient(135deg,#F4845F,#F4A261);color:#fff;text-decoration:none;border-radius:14px;font-weight:800;font-size:1.05rem;line-height:1.35;transition:.3s;box-shadow:0 4px 15px rgba(244,132,95,.4)}
    .btn:hover{transform:translateY(-3px);box-shadow:0 6px 25px rgba(244,132,95,.6)}

    .footer{background:linear-gradient(135deg,#2D6A4F,#40916C);color:#fff;text-align:center;padding:2rem}
    .loading{text-align:center;padding:5rem 2rem;font-size:1.4rem;color:#2D6A4F;font-weight:800}

    /* æ‰‹æ©Ÿï¼šHero å…§å®¹é å·¦ï¼Œä¸¦ä¿ç•™ä¸Š/ä¸‹è· */
    @media (max-width:768px){
      .floating-nav{left:10px;padding:.5rem}
      .floating-nav a{width:40px;height:40px;font-size:1.2rem;margin:.3rem 0}

      .hero-section{
        height:34vh;min-height:200px;
        justify-content:flex-start;  /* æ‰‹æ©Ÿé å·¦ */
      }
      .hero-content{
        text-align:left;
        margin-left:0;
        padding:1rem clamp(20px,6vw,28px);
        margin-top:clamp(16px,7vh,64px);   /* é ‚éƒ¨å¤šä¸€é» */
        margin-bottom:clamp(12px,7vh,56px);/* âœ… åº•éƒ¨ä¹Ÿå¤šä¸€é» */
      }
      .hero-content h1{font-size:2.1rem}
      .hero-content .subtitle{font-size:1.2rem}
      .hero-content .description{font-size:1rem}

      .hero-grid{display:none}
      .hero-carousel{display:block}

      .container{padding:2rem 1rem}
      .content-section{padding:2rem 1.4rem}
      .content-section h2{font-size:1.6rem}
      .info-grid{grid-template-columns:1fr}
      .map-container{height:300px}

      .cta-section h2{font-size:1.6rem}
      .cta-section p{font-size:1.02rem}
      .btn{padding:.85rem 1.15rem;font-size:.95rem;border-radius:12px}
    }
  </style>
</head>
<body>
  <!-- æµ®å‹•å°è¦½ -->
  <nav class="floating-nav">
    <a href="index.html" title="é¦–é ">ğŸ </a>
    <a href="experiences.html" title="é«”é©—åˆ—è¡¨">ğŸŒŸ</a>
    <a href="index.html#about" title="é—œæ–¼">â„¹ï¸</a>
    <a href="index.html#contact" title="è¯çµ¡">âœ‰ï¸</a>
  </nav>

  <button class="back-to-top" onclick="scrollToTop()">â†‘</button>

  <div id="loading" class="loading">è¼‰å…¥é«”é©—è³‡è¨Šä¸­... Loading experience details...</div>

  <div id="content" style="display:none;">
    <!-- Hero -->
    <section class="hero-section" id="heroSection">
      <div class="hero-media">
        <!-- æ¡Œæ©Ÿï¼šä¸‰å¼µä¸¦æ’ -->
        <div class="hero-grid" id="heroGrid"></div>
        <!-- æ‰‹æ©Ÿï¼šå–®å¼µè¼ªæ’­ -->
        <div class="hero-carousel" id="heroCarousel"></div>
      </div>
      <div class="hero-overlay"></div>
      <div class="hero-content" id="heroContent"></div>
    </section>

    <div class="container">
      <!-- è©³ç´°èªªæ˜ -->
      <div class="content-section doc-render" id="detailSection">
        <div class="doc-render-inner" id="docRenderInner">
          <h2>ğŸ“– è©³ç´°èªªæ˜ Details</h2>
          <div class="loading-line" style="margin:12px 0;width:60%"></div>
          <div class="loading-line" style="margin:12px 0;width:80%"></div>
          <div class="loading-line" style="margin:12px 0;width:40%"></div>
        </div>
      </div>

      <!-- è¯çµ¡è³‡è¨Š -->
      <div class="content-section" id="contactSection"></div>

      <!-- åœ°åœ– -->
      <div class="map-section" id="mapSection"></div>

      <!-- CTA -->
      <div class="cta-section">
        <h2>æº–å‚™å¥½é–‹å§‹ä½ çš„é«”é©—äº†å—ï¼Ÿ</h2>
        <h2>Ready to Start Your Experience?</h2>
        <p>ç›´æ¥è¯ç¹«ä¸»è¾¦å–®ä½å®‰æ’ä½ çš„å°ˆå±¬é«”é©—<br>Contact the organizer to arrange your unique experience</p>
        <a href="experiences.html" class="btn">â† ç€è¦½æ›´å¤šé«”é©— Browse More Experiences</a>
      </div>
    </div>
  </div>

  <footer class="footer">
    <p><strong>Local Friends Taiwan å°ç£åœ¨åœ°é€£ç·š</strong></p>
    <p style="margin-top:1rem;opacity:.9">Your local friend in Taiwan | ä½ åœ¨å°ç£çš„åœ¨åœ°æœ‹å‹</p>
  </footer>

  <script>
    const SHEET_ID  = '1GD4gg3sGIfX7KGrJkYCL10wzvwZh5FMWQPGd9NVTQyc';
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;
    const FALLBACK_DOC_URL = 'https://docs.google.com/document/d/e/2PACX-1vQj1gYlRDbgpH-IupwfkeS8kSMIvGb9TadFFwGpzj9TJXLYv3kzvhu9BqcpUetG-y7Dpt2M8qJLFkoV/pub';

    let slideTimer = null;

    async function loadExperience(){
      const id = new URLSearchParams(window.location.search).get('id');
      if(!id){
        document.getElementById('loading').innerHTML = `
          <p>æ‰¾ä¸åˆ°é«”é©— ID Experience ID not found</p>
          <p style="margin-top:1rem;"><a href="experiences.html" style="color:#F4845F;font-weight:700;">â† è¿”å›é«”é©—åˆ—è¡¨ Back to Experiences</a></p>`;
        return;
      }
      try{
        const txt = await (await fetch(SHEET_URL)).text();
        const rows = parseCSV(txt);
        const headers = rows[0];
        const data = rows.slice(1);
        const exp = data.map(r=>{
          const o={}; headers.forEach((h,i)=>o[h]=r[i]||''); return o;
        }).find(o=>(o['ID']||'').toLowerCase()===id.toLowerCase());
        if(!exp){
          document.getElementById('loading').innerHTML = `
            <p>æ‰¾ä¸åˆ°æ­¤é«”é©— Experience not found</p>
            <p style="margin-top:1rem;"><a href="experiences.html" style="color:#F4845F;font-weight:700;">â† è¿”å›é«”é©—åˆ—è¡¨ Back to Experiences</a></p>`;
          return;
        }
        renderPage(exp);
      }catch(err){
        console.error(err);
        document.getElementById('loading').textContent='âš ï¸ ç„¡æ³•è¼‰å…¥è³‡æ–™ Error loading data';
      }
    }

    function parseCSV(csv){
      const lines = csv.split('\n');
      return lines.map(line=>{
        const values=[]; let cur=''; let inQ=false;
        for(const ch of line){
          if(ch==='"') inQ=!inQ;
          else if(ch===',' && !inQ){ values.push(cur.trim()); cur=''; }
          else cur+=ch;
        }
        values.push(cur.trim());
        return values;
      });
    }

    function renderPage(exp){
      document.getElementById('loading').style.display='none';
      document.getElementById('content').style.display='block';
      document.title = `${exp['é«”é©—åç¨±(ä¸­)']} - Local Friends Taiwan | å°ç£åœ¨åœ°é€£ç·š`;

      renderHero(exp);
      renderDetailFromDoc(exp);
      renderContact(exp);
      renderMap(exp);
    }

    /* ---------------- é ‚éƒ¨åœ–ç‰‡ï¼šæ¡Œæ©Ÿä¸‰å¼µä¸¦æ’ï¼ˆå¡«æ»¿ï¼‰ã€æ‰‹æ©Ÿå–®å¼µè¼ªæ’­ ---------------- */
    function getPhotoLinks(exp){
      const raw = (exp['ç…§ç‰‡é›†'] || exp['å°é¢åœ–é€£çµ'] || exp['åœ–ç‰‡'] || '').replace(/ï¼Œ/g, ',');
      return raw.split(/[,\s]+/).map(s=>s.trim()).filter(Boolean);
    }

    function renderHero(exp){
      const grid = document.getElementById('heroGrid');
      const carousel = document.getElementById('heroCarousel');
      const links = getPhotoLinks(exp);

      /* æ¡Œæ©Ÿï¼šä¸‰å¼µä¸¦æ’ï¼ˆä¸è¼ªæ’­ï¼›ä½¿ç”¨ cover å¡«æ»¿ï¼‰ */
      const gridItems = (links.length? links.slice(0,3) : [null,null,null]).map((url,i)=>`
        <div class="hero-grid-item">
          ${url ? `<img src="${url}" alt="hero ${i+1}" onerror="this.style.display='none'">` : ``}
        </div>`).join('');
      grid.innerHTML = gridItems;

      /* æ‰‹æ©Ÿï¼šå–®å¼µè¼ªæ’­ */
      const mobileItems = (links.length? links : []).map((url,i)=>`
        <div class="hero-slide ${i===0?'active':''}">
          <img src="${url}" alt="slide ${i+1}" onerror="this.parentElement.innerHTML='<div style=&quot;width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#fff;opacity:.9&quot;>ğŸ“·</div>'">
        </div>`).join('');
      carousel.innerHTML = mobileItems || `<div class="hero-slide active"></div>`;

      startMobileCarousel();

      /* æ–‡å­—ï¼ˆç„¡ç‹€æ…‹ tagï¼‰ */
      const heroContent = document.getElementById('heroContent');
      heroContent.innerHTML = `
        <h1>${exp['é«”é©—åç¨±(ä¸­)']||''}</h1>
        ${exp['é«”é©—åç¨±(è‹±)']?`<div class="subtitle">${exp['é«”é©—åç¨±(è‹±)']}</div>`:''}
        <div class="description">${exp['ä¸€å¥è©±æè¿°(ä¸­)']||''}</div>
        <div class="hero-tags">
          ${exp['åœ°å€']?`<span class="hero-tag">ğŸ“ ${exp['åœ°å€']}</span>`:''}
          ${exp['ä¸»è¦åˆ†é¡']?`<span class="hero-tag">${exp['ä¸»è¦åˆ†é¡']}</span>`:''}
          ${exp['é›£åº¦']?`<span class="hero-tag">â­ é›£åº¦: ${exp['é›£åº¦']}</span>`:''}
        </div>`;
    }

    function startMobileCarousel(){
      clearInterval(slideTimer);
      const slides = document.querySelectorAll('#heroCarousel .hero-slide');
      if(slides.length<=1) return;
      let idx = 0;
      slideTimer = setInterval(()=>{
        slides[idx].classList.remove('active');
        idx = (idx+1)%slides.length;
        slides[idx].classList.add('active');
      }, 5000);

      // æ‰‹å‹¢æ»‘å‹•
      const el = document.getElementById('heroCarousel');
      let sx=0, ex=0;
      el.addEventListener('touchstart',e=>{sx=e.changedTouches[0].clientX},{passive:true});
      el.addEventListener('touchend',e=>{
        ex=e.changedTouches[0].clientX;
        const dx = ex - sx;
        if(Math.abs(dx)>40){
          slides[idx].classList.remove('active');
          idx = (idx + (dx>0?-1:1) + slides.length) % slides.length;
          slides[idx].classList.add('active');
          clearInterval(slideTimer);
          startMobileCarousel();
        }
      },{passive:true});
    }

    /* ---------------- è©³ç´°èªªæ˜ï¼šæ“·å– Google Doc å…§å®¹ï¼ˆå«åœ–ç‰‡ï¼‰ ---------------- */
    async function renderDetailFromDoc(exp){
      const inner = document.getElementById('docRenderInner');
      inner.innerHTML = '<h2>ğŸ“– è©³ç´°èªªæ˜ Details</h2>';

      const raw = (exp['è©³ç´°èªªæ˜é€£çµ'] || exp['Google Doc'] || exp['Google Doc é€£çµ'] || '').trim();
      const url = raw || FALLBACK_DOC_URL;
      const fetchURL = toFetchableDocURL(url);

      try{
        const resp = await fetch(fetchURL,{mode:'cors'});
        const html = await resp.text();

        const tmp = document.createElement('div');
        tmp.innerHTML = html;

        let main = tmp.querySelector('#contents') || tmp.querySelector('body') || tmp;
        main.querySelectorAll('link,style,header,nav,script').forEach(n=>n.remove());

        const wrapper = document.createElement('div');
        wrapper.innerHTML = main.innerHTML;

        /* âœ… å…¨é¢æ¸…æ‰å›ºå®šå¯¬åº¦ï¼Œåœ–ç‰‡ç¸®å°ä¸å‡ºæ¡†ï¼›è¡¨æ ¼åŒ…é€²å¯æ©«æ²å®¹å™¨ */
        // 1) ä»»ä½•å…ƒç´ ï¼šç§»é™¤ inline width èˆ‡éæ–¼å¼·åˆ¶çš„ max-width
        wrapper.querySelectorAll('*').forEach(el=>{
          const styleStr = el.getAttribute('style') || '';
          if (el.hasAttribute('width')) el.removeAttribute('width');
          if (/(\b|;) *width *:/.test(styleStr)) el.style.width = '';
          if (/(\b|;) *max-width *: *\d+(px|pt)/.test(styleStr)) el.style.maxWidth = '';
          // ä¿åº•ä¸å‡ºæ¡†
          if (el !== wrapper) el.style.boxSizing = 'border-box';
        });

        // 2) åœ–ç‰‡ï¼šå¼·åˆ¶è‡ªé©æ‡‰
        wrapper.querySelectorAll('img').forEach(img=>{
          img.removeAttribute('height');
          img.style.maxWidth='100%';
          img.style.height='auto';
          img.loading='lazy';
          img.style.display='block';
          img.style.margin='1rem auto';
          img.style.borderRadius='8px';
          img.style.boxShadow='0 2px 12px rgba(0,0,0,.06)';
          img.onerror = () => {
            img.replaceWith(Object.assign(document.createElement('div'),{
              textContent:'ğŸ“· åœ–ç‰‡ç„¡æ³•è¼‰å…¥',
              style:'text-align:center;color:#888;padding:1rem 0'
            }));
          };
        });

        // 3) è¡¨æ ¼ï¼šæ©«å‘æ²å‹•ï¼ˆåœ–ç‰‡ç¸®å°ï¼Œåœ–è¡¨å¯æ²å‹•ï¼‰
        wrapper.querySelectorAll('table').forEach(t=>{
          const w = document.createElement('div');
          w.className = 'table-scroll';
          w.style.overflowX='auto';
          w.style.webkitOverflowScrolling='touch';
          w.style.margin='1rem 0';
          t.parentNode.insertBefore(w,t);
          w.appendChild(t);
        });

        // 4) å…§åµŒ iframe ä¹Ÿä¸å¤–æº¢
        wrapper.querySelectorAll('iframe').forEach(f=>{
          f.removeAttribute('width');
          f.style.width='100%';
          f.style.maxWidth='100%';
        });

        inner.appendChild(wrapper);
      }catch(err){
        console.warn('Doc fetch blocked (CORS). Fallback to iframe.', err);
        inner.insertAdjacentHTML('beforeend', `
          <iframe src="${toEmbeddableIframeURL(url)}"
                  style="width:100%;height:900px;border:0;border-radius:12px;background:#fff"
                  loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>`);
      }
    }

    function toFetchableDocURL(url){
      if(/\/document\/d\/e\/[^/]+\/pub/.test(url)){
        return url.includes('?') ? url : url + '?embedded=true';
      }
      const m = url.match(/\/document\/d\/([^/]+)/);
      if(m){
        const id = m[1];
        return `https://docs.google.com/document/d/${id}/export?format=html`;
      }
      return url;
    }
    function toEmbeddableIframeURL(url){
      if(/\/document\/d\/e\/[^/]+\/pub/.test(url)){
        return url.includes('?') ? url+'&embedded=true' : url+'?embedded=true';
      }
      const m = url.match(/\/document\/d\/([^/]+)/);
      if(m){
        const id = m[1];
        return `https://docs.google.com/document/d/${id}/preview?rm=minimal&embedded=true`;
      }
      return url;
    }

    /* ---------------- è¯çµ¡è³‡è¨Š ---------------- */
    function renderContact(exp){
      const box = document.getElementById('contactSection');
      let html = '<h2>ğŸ“ è¯çµ¡è³‡è¨Š Contact Information</h2><div class="info-grid">';
      let has = false;
      if(exp['ä¸»è¾¦å–®ä½']){ html+=`<div class="info-item"><h4>ğŸ¢ ä¸»è¾¦å–®ä½ Organizer</h4><p>${exp['ä¸»è¾¦å–®ä½']}</p></div>`; has=true; }
      if(exp['è¯çµ¡äºº']){ html+=`<div class="info-item"><h4>ğŸ‘¤ è¯çµ¡äºº Contact Person</h4><p>${exp['è¯çµ¡äºº']}</p></div>`; has=true; }
      if(exp['é›»è©±']){ html+=`<div class="info-item"><h4>ğŸ“± é›»è©± Phone</h4><p><a href="tel:${exp['é›»è©±']}">${exp['é›»è©±']}</a></p></div>`; has=true; }
      if(exp['Email']){ html+=`<div class="info-item"><h4>âœ‰ï¸ Email</h4><p><a href="mailto:${exp['Email']}">${exp['Email']}</a></p></div>`; has=true; }
      if(exp['ç¶²ç«™']){ html+=`<div class="info-item"><h4>ğŸŒ ç¶²ç«™ Website</h4><p><a href="${exp['ç¶²ç«™']}" target="_blank">${exp['ç¶²ç«™']}</a></p></div>`; has=true; }
      if(exp['ç¤¾ç¾¤åª’é«”']){ html+=`<div class="info-item"><h4>ğŸ“± ç¤¾ç¾¤åª’é«” Social Media</h4><p><a href="${exp['ç¤¾ç¾¤åª’é«”']}" target="_blank">${exp['ç¤¾ç¾¤åª’é«”']}</a></p></div>`; has=true; }
      html+='</div>';
      if(has) box.innerHTML = html; else box.style.display='none';
    }

    /* ---------------- åœ°åœ– ---------------- */
    function renderMap(exp){
      const box = document.getElementById('mapSection');
      const addr = (exp['åœ°å€']||'').trim();
      if(!addr){ box.style.display='none'; return; }
      const src = `https://www.google.com/maps?q=${encodeURIComponent(addr)}&output=embed`;
      box.innerHTML = `
        <h2>ğŸ“ ä½ç½®è³‡è¨Š Location</h2>
        <div class="map-address">ğŸ“ ${addr}</div>
        <div class="map-container"><iframe src="${src}" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe></div>`;
    }

    function scrollToTop(){ window.scrollTo({top:0,behavior:'smooth'}) }
    window.addEventListener('scroll',()=>{
      const b=document.querySelector('.back-to-top');
      if(window.pageYOffset>300) b.classList.add('show'); else b.classList.remove('show');
    });

    window.addEventListener('DOMContentLoaded', loadExperience);
  </script>
</body>
</html>
