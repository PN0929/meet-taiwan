<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>é«”é©—è©³æƒ… - Local Friends Taiwan | å°ç£åœ¨åœ°é€£ç·š</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif;
            line-height: 1.6; color: #2D6A4F; background: #F7F5F2;
        }

        /* æµ®å‹•å°è¦½åˆ— */
        .floating-nav {
            position: fixed; left: 20px; top: 50%; transform: translateY(-50%);
            z-index: 1000; background: white; padding: 1rem; border-radius: 30px;
            box-shadow: 0 4px 20px rgba(45,106,79,.2); border: 2px solid #2D6A4F;
        }
        .floating-nav a {
            display: block; width: 50px; height: 50px; margin: .5rem 0; border-radius: 50%;
            background: linear-gradient(135deg,#2D6A4F,#40916C); color: #fff; text-decoration: none;
            display:flex; align-items:center; justify-content:center; font-size:1.5rem; transition: .3s;
        }
        .floating-nav a:hover { transform: scale(1.1); background: linear-gradient(135deg,#40916C,#52B788); }

        /* å›é ‚æŒ‰éˆ• */
        .back-to-top {
            position: fixed; right: 30px; bottom: 30px; width: 60px; height: 60px;
            background: linear-gradient(135deg,#F4845F,#F4A261); color:#fff; border:none; border-radius:50%;
            font-size:1.5rem; cursor:pointer; box-shadow:0 4px 20px rgba(244,132,95,.4);
            display:none; z-index:999; transition: transform .3s;
        }
        .back-to-top:hover { transform: translateY(-5px); }
        .back-to-top.show { display:flex; align-items:center; justify-content:center; }

        /* Hero Sectionï¼ˆç¸®å°é«˜åº¦ã€è³‡è¨Šå°å‘ï¼‰ */
        .hero-section {
            position: relative; height: 42vh; min-height: 220px; max-height: 460px;
            display:flex; align-items:center; justify-content:center; text-align:center;
            overflow: hidden; background: #2D6A4F;
        }
        .hero-background { position: absolute; inset: 0; z-index: 1; }
        .hero-slide { position:absolute; inset:0; opacity:0; transition: opacity 1s ease;
            background: linear-gradient(135deg,#2D6A4F,#40916C); }
        .hero-slide.active { opacity: 1; }
        /* 1. æ¯å¼µåœ–ä¿æŒåŸå§‹æ¯”ä¾‹ */
        .hero-slide img { width: 100%; height: 100%; object-fit: contain; display:block; background: transparent; }
        /* 3. ç¶ è‰²é®ç½©ï¼ˆå“ç‰Œè‰²ï¼‰ */
        .hero-overlay { position:absolute; inset:0; background: rgba(45,106,79,0.6); z-index:2; }

        .hero-content {
            position: relative; z-index:3; color:#fff; max-width:1000px; padding: 1.25rem 2rem;
            animation: fadeInUp 0.8s ease;
        }
        .hero-content h1 { font-size: 2.4rem; font-weight: 800; margin-bottom: .4rem; text-shadow: 2px 2px 8px rgba(0,0,0,.3); line-height: 1.2; }
        .hero-content .subtitle { font-size: 1.3rem; margin-bottom: .8rem; opacity:.95; text-shadow:1px 1px 4px rgba(0,0,0,.3); }
        .hero-content .description { font-size: 1.1rem; margin-bottom: 1.2rem; line-height: 1.7; opacity:.9; text-shadow:1px 1px 4px rgba(0,0,0,.3); }
        .hero-tags { display:flex; gap:.6rem; justify-content:center; flex-wrap:wrap; }
        .hero-tag {
            padding: .6rem 1.1rem; background: rgba(255,255,255,.2); backdrop-filter: blur(10px);
            border:2px solid rgba(255,255,255,.3); border-radius: 30px; color:#fff; font-size: .95rem; font-weight:600;
            text-shadow:1px 1px 2px rgba(0,0,0,.3);
        }
        .hero-status {
            padding: .6rem 1.1rem; background:linear-gradient(135deg,#F4845F,#F4A261);
            border:2px solid rgba(255,255,255,.5); border-radius: 30px; color:#fff; font-size:.95rem; font-weight:700;
            box-shadow:0 4px 15px rgba(244,132,95,.4);
        }

        /* å®¹å™¨èˆ‡å…§å®¹å€ */
        .container { max-width: 1200px; margin: 0 auto; padding: 3rem 2rem; }
        .content-section {
            background:#fff; padding: 3rem; border-radius: 15px; margin-bottom: 2rem;
            border: 3px solid #E9C46A; box-shadow: 0 4px 20px rgba(233,196,106,.2);
        }
        .content-section h2 {
            display:flex; align-items:center; justify-content: space-between;
            font-size: 2rem; color:#2D6A4F; margin-bottom: 1.2rem; font-weight: 800;
            border-bottom:3px solid #E9C46A; padding-bottom:.5rem;
        }
        .content-section h3 { font-size: 1.5rem; color:#2D6A4F; margin: 2rem 0 1rem; font-weight: 700; }
        .content-section p { font-size: 1.2rem; color:#555; line-height: 1.9; margin-bottom: 1.2rem; }

        .info-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 2rem; margin-top: 1.2rem; }
        .info-item { background:#F7F5F2; padding: 1.6rem; border-radius: 12px; border:2px solid #E9C46A; }
        .info-item h4 { font-size:1.2rem; color:#2D6A4F; margin-bottom:.8rem; font-weight: 800; }
        .info-item p { font-size:1.05rem; margin-bottom:.4rem; }
        .info-item a { color:#F4845F; text-decoration: none; font-weight:700; word-break: break-all; }
        .info-item a:hover { text-decoration: underline; }

        /* è©³ç´°èªªæ˜å³å´æŒ‰éˆ• */
        .doc-link-btn {
            display:inline-block; margin-left: .8rem; padding: .5rem .9rem;
            font-size:.95rem; border-radius: 999px; border:2px solid #E9C46A;
            color:#2D6A4F; background:#FFF9E6; text-decoration:none; font-weight:800;
        }
        .doc-link-btn:hover { background:#FFF1BF; }

        /* åœ°åœ–å€å¡Š */
        .map-section {
            background:#fff; padding: 2rem; border-radius: 15px; border: 3px solid #E9C46A; box-shadow: 0 4px 20px rgba(233,196,106,.2);
            margin-bottom: 2rem;
        }
        .map-section h2 { font-size: 2rem; color:#2D6A4F; margin-bottom: 1rem; font-weight: 800; }
        .map-address {
            font-size: 1.1rem; color:#555; margin-bottom: 1.2rem; padding: .9rem 1rem; background:#F7F5F2; border-radius: 8px; border-left: 4px solid #E9C46A;
        }
        .map-container { width: 100%; height: 450px; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(45,106,79,.15); }
        .map-container iframe { width:100%; height:100%; border:0; }

        .cta-section {
            background: linear-gradient(135deg,#2D6A4F,#40916C); color:#fff; padding: 3rem; border-radius: 15px; text-align: center; box-shadow: 0 4px 20px rgba(45,106,79,.3);
        }
        .cta-section h2 { font-size: 2.2rem; margin-bottom: 1rem; font-weight: 800; }
        .cta-section p { font-size: 1.2rem; margin-bottom: 2rem; opacity: .95; }
        .btn {
            display:inline-block; padding: 1.1rem 2.5rem; background: linear-gradient(135deg,#F4845F,#F4A261);
            color:#fff; text-decoration:none; border-radius: 50px; font-weight: 800; font-size: 1.1rem;
            transition: .3s; box-shadow: 0 4px 15px rgba(244,132,95,.4);
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 6px 25px rgba(244,132,95,.6); }

        .footer { background: linear-gradient(135deg,#2D6A4F,#40916C); color:#fff; text-align:center; padding: 2rem; }
        .loading { text-align:center; padding: 5rem 2rem; font-size: 1.4rem; color:#2D6A4F; font-weight: 800; }

        /* å‹•ç•« */
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px);} to { opacity: 1; transform: translateY(0);} }

        /* æ‰‹æ©Ÿç‰ˆé©é…ï¼ˆHero æ›´ç·Šæ¹Šï¼‰ */
        @media (max-width: 768px) {
            .floating-nav { left: 10px; padding: .5rem; }
            .floating-nav a { width: 40px; height: 40px; font-size: 1.2rem; margin: .3rem 0; }

            .hero-section { height: 34vh; min-height: 200px; }
            .hero-content h1 { font-size: 1.8rem; }
            .hero-content .subtitle { font-size: 1.1rem; }
            .hero-content .description { font-size: .95rem; }

            .container { padding: 2rem 1rem; }
            .content-section { padding: 2rem 1.4rem; }
            .content-section h2 { font-size: 1.6rem; }
            .info-grid { grid-template-columns: 1fr; }
            .map-container { height: 300px; }
        }
    </style>
</head>
<body>
    <!-- æµ®å‹•å°è¦½ -->
    <nav class="floating-nav">
        <a href="index.html" title="é¦–é ">ğŸ </a>
        <a href="experiences.html" title="é«”é©—åˆ—è¡¨">ğŸŒŸ</a>
        <a href="index.html#about" title="é—œæ–¼">â„¹ï¸</a>
        <a href="index.html#contact" title="è¯çµ¡">âœ‰ï¸</a>
    </nav>

    <!-- å›é ‚æŒ‰éˆ• -->
    <button class="back-to-top" onclick="scrollToTop()">â†‘</button>

    <div id="loading" class="loading">è¼‰å…¥é«”é©—è³‡è¨Šä¸­... Loading experience details...</div>

    <div id="content" style="display: none;">
        <!-- Heroï¼ˆç¸®å°é«˜åº¦ã€ç„¡å‘ä¸‹ç®­é ­ï¼‰ -->
        <section class="hero-section" id="heroSection">
            <div class="hero-background" id="heroBackground"></div>
            <div class="hero-overlay"></div>
            <div class="hero-content" id="heroContent"></div>
            <!-- ç§»é™¤ scroll indicatorï¼ˆä¾ç…§ä½ çš„è¦æ±‚ä¸é¡¯ç¤ºç®­é ­ï¼‰ -->
        </section>

        <div class="container">
            <!-- è©³ç´°èªªæ˜ -->
            <div class="content-section" id="detailSection"></div>

            <!-- è¯çµ¡è³‡è¨Š -->
            <div class="content-section" id="contactSection"></div>

            <!-- åœ°åœ– -->
            <div class="map-section" id="mapSection"></div>

            <!-- CTA -->
            <div class="cta-section">
                <h2>æº–å‚™å¥½é–‹å§‹ä½ çš„é«”é©—äº†å—ï¼Ÿ</h2>
                <h2>Ready to Start Your Experience?</h2>
                <p>ç›´æ¥è¯ç¹«ä¸»è¾¦å–®ä½å®‰æ’ä½ çš„å°ˆå±¬é«”é©—<br />Contact the organizer to arrange your unique experience</p>
                <a href="experiences.html" class="btn">â† ç€è¦½æ›´å¤šé«”é©— Browse More Experiences</a>
            </div>
        </div>
    </div>

    <footer class="footer">
        <p><strong>Local Friends Taiwan å°ç£åœ¨åœ°é€£ç·š</strong></p>
        <p style="margin-top: 1rem; opacity: .9;">Your local friend in Taiwan | ä½ åœ¨å°ç£çš„åœ¨åœ°æœ‹å‹</p>
    </footer>

    <script>
        const SHEET_ID = '1GD4gg3sGIfX7KGrJkYCL10wzvwZh5FMWQPGd9NVTQyc';
        const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;

        // ä½ æä¾›çš„ Google Doc é è¨­é€£çµï¼ˆç•¶ Sheet æ²’æœ‰å°æ‡‰æ¬„ä½æ™‚ä½¿ç”¨ï¼‰
        const FALLBACK_DOC_URL = 'https://docs.google.com/document/d/e/2PACX-1vQj1gYlRDbgpH-IupwfkeS8kSMIvGb9TadFFwGpzj9TJXLYv3kzvhu9BqcpUetG-y7Dpt2M8qJLFkoV/pub';

        let currentSlide = 0;
        let slideCount = 0;
        let slideInterval;

        async function loadExperience() {
            const urlParams = new URLSearchParams(window.location.search);
            const experienceId = urlParams.get('id');

            if (!experienceId) {
                document.getElementById('loading').innerHTML = `
                    <p>æ‰¾ä¸åˆ°é«”é©— ID Experience ID not found</p>
                    <p style="margin-top: 1rem;"><a href="experiences.html" style="color: #F4845F; font-weight: bold;">â† è¿”å›é«”é©—åˆ—è¡¨ Back to Experiences</a></p>
                `;
                return;
            }

            try {
                const response = await fetch(SHEET_URL);
                const csvText = await response.text();
                const rows = parseCSV(csvText);
                const headers = rows[0];
                const data = rows.slice(1);

                const experience = data.map(row => {
                    const obj = {};
                    headers.forEach((header, index) => { obj[header] = row[index] || ''; });
                    return obj;
                }).find(exp => (exp['ID'] || '').toLowerCase() === experienceId.toLowerCase());

                if (!experience) {
                    document.getElementById('loading').innerHTML = `
                        <p>æ‰¾ä¸åˆ°æ­¤é«”é©— Experience not found</p>
                        <p style="margin-top: 1rem;"><a href="experiences.html" style="color: #F4845F; font-weight: bold;">â† è¿”å›é«”é©—åˆ—è¡¨ Back to Experiences</a></p>
                    `;
                    return;
                }

                displayExperience(experience);

            } catch (error) {
                console.error('è¼‰å…¥å¤±æ•—:', error);
                document.getElementById('loading').innerHTML = `
                    <p>è¼‰å…¥é«”é©—æ™‚ç™¼ç”ŸéŒ¯èª¤ Error loading experience</p>
                    <p style="margin-top: 1rem;"><a href="experiences.html" style="color: #F4845F; font-weight: bold;">â† è¿”å›é«”é©—åˆ—è¡¨ Back to Experiences</a></p>
                `;
            }
        }

        function parseCSV(csv) {
            const lines = csv.split('\n');
            return lines.map(line => {
                const values = [];
                let current = '';
                let inQuotes = false;

                for (let i = 0; i < line.length; i++) {
                    const char = line[i];
                    if (char === '"') inQuotes = !inQuotes;
                    else if (char === ',' && !inQuotes) { values.push(current.trim()); current = ''; }
                    else { current += char; }
                }
                values.push(current.trim());
                return values;
            });
        }

        function displayExperience(exp) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('content').style.display = 'block';

            document.title = `${exp['é«”é©—åç¨±(ä¸­)']} - Local Friends Taiwan | å°ç£åœ¨åœ°é€£ç·š`;

            // Hero
            displayHero(exp);

            // è©³ç´°èªªæ˜ï¼ˆå« Google Doc é€£çµï¼‰
            const detailSection = document.getElementById('detailSection');
            const docUrlFromSheet =
                exp['è©³ç´°èªªæ˜é€£çµ'] || exp['Google Doc'] || exp['Google Doc é€£çµ'] || FALLBACK_DOC_URL;

            let detailHTML = `
                <h2>
                    <span>ğŸ“– è©³ç´°èªªæ˜ Details</span>
                    <a href="${docUrlFromSheet}" target="_blank" rel="noopener" class="doc-link-btn">åœ¨ Google Docs é–‹å•Ÿ</a>
                </h2>
            `;

            if (exp['è©³ç´°èªªæ˜(ä¸­)']) detailHTML += formatContent(exp['è©³ç´°èªªæ˜(ä¸­)']);
            if (exp['è©³ç´°èªªæ˜(è‹±)']) detailHTML += `<h3>English Description:</h3>${formatContent(exp['è©³ç´°èªªæ˜(è‹±)'])}`;
            if (!exp['è©³ç´°èªªæ˜(ä¸­)'] && !exp['è©³ç´°èªªæ˜(è‹±)']) detailHTML += '<p>è©³ç´°è³‡è¨Šæº–å‚™ä¸­... Details coming soon...</p>';

            // è³‡è¨Šå¡ç‰‡
            let infoCards = '';
            if (exp['é©åˆå°è±¡']) infoCards += `<div class="info-item"><h4>ğŸ‘¥ é©åˆå°è±¡ Who Should Join</h4><p>${exp['é©åˆå°è±¡']}</p></div>`;
            if (exp['å»ºè­°åœç•™æ™‚é–“']) infoCards += `<div class="info-item"><h4>â° å»ºè­°åœç•™æ™‚é–“ Duration</h4><p>${exp['å»ºè­°åœç•™æ™‚é–“']}</p></div>`;
            if (exp['æœ€ä½³å­£ç¯€']) infoCards += `<div class="info-item"><h4>ğŸŒ¸ æœ€ä½³å­£ç¯€ Best Season</h4><p>${exp['æœ€ä½³å­£ç¯€']}</p></div>`;
            if (exp['åƒ¹æ ¼ç¯„åœ']) infoCards += `<div class="info-item"><h4>ğŸ’° åƒ¹æ ¼ç¯„åœ Price Range</h4><p>${exp['åƒ¹æ ¼ç¯„åœ']}</p></div>`;
            if (infoCards) detailHTML += `<div class="info-grid">${infoCards}</div>`;

            detailSection.innerHTML = detailHTML;

            // è¯çµ¡è³‡è¨Š
            const contactSection = document.getElementById('contactSection');
            let contactHTML = '<h2>ğŸ“ è¯çµ¡è³‡è¨Š Contact Information</h2><div class="info-grid">';
            let hasContact = false;

            if (exp['ä¸»è¾¦å–®ä½']) { contactHTML += `<div class="info-item"><h4>ğŸ¢ ä¸»è¾¦å–®ä½ Organizer</h4><p>${exp['ä¸»è¾¦å–®ä½']}</p></div>`; hasContact = true; }
            if (exp['è¯çµ¡äºº']) { contactHTML += `<div class="info-item"><h4>ğŸ‘¤ è¯çµ¡äºº Contact Person</h4><p>${exp['è¯çµ¡äºº']}</p></div>`; hasContact = true; }
            if (exp['é›»è©±']) { contactHTML += `<div class="info-item"><h4>ğŸ“± é›»è©± Phone</h4><p><a href="tel:${exp['é›»è©±']}">${exp['é›»è©±']}</a></p></div>`; hasContact = true; }
            if (exp['Email']) { contactHTML += `<div class="info-item"><h4>âœ‰ï¸ Email</h4><p><a href="mailto:${exp['Email']}">${exp['Email']}</a></p></div>`; hasContact = true; }
            if (exp['ç¶²ç«™']) { contactHTML += `<div class="info-item"><h4>ğŸŒ ç¶²ç«™ Website</h4><p><a href="${exp['ç¶²ç«™']}" target="_blank">${exp['ç¶²ç«™']}</a></p></div>`; hasContact = true; }
            if (exp['ç¤¾ç¾¤åª’é«”']) { contactHTML += `<div class="info-item"><h4>ğŸ“± ç¤¾ç¾¤åª’é«” Social Media</h4><p><a href="${exp['ç¤¾ç¾¤åª’é«”']}" target="_blank">${exp['ç¤¾ç¾¤åª’é«”']}</a></p></div>`; hasContact = true; }
            contactHTML += '</div>';
            if (hasContact) contactSection.innerHTML = contactHTML; else contactSection.style.display = 'none';

            // åœ°åœ–ï¼ˆç”¨åœ°å€è‡ªå‹•ç”ŸæˆåµŒå…¥ï¼‰
            displayMap(exp);
        }

        function displayHero(exp) {
            const heroBackground = document.getElementById('heroBackground');
            const heroContent = document.getElementById('heroContent');

            let photoLinks = (exp['ç…§ç‰‡é›†'] || exp['å°é¢åœ–é€£çµ'] || '')
                .split(',')
                .map(s => s.trim())
                .filter(Boolean);

            if (photoLinks.length > 0) {
                slideCount = photoLinks.length;
                heroBackground.innerHTML = photoLinks.map((link, idx) => `
                    <div class="hero-slide ${idx === 0 ? 'active' : ''}">
                        <img src="${link}" alt="${exp['é«”é©—åç¨±(ä¸­)'] || 'experience'} åœ–ç‰‡ ${idx+1}" />
                    </div>
                `).join('');
                startSlideShow();
            } else {
                slideCount = 0;
                heroBackground.innerHTML = `<div class="hero-slide active"></div>`;
            }

            heroContent.innerHTML = `
                <h1>${exp['é«”é©—åç¨±(ä¸­)'] || ''}</h1>
                ${exp['é«”é©—åç¨±(è‹±)'] ? `<div class="subtitle">${exp['é«”é©—åç¨±(è‹±)']}</div>` : ''}
                <div class="description">${exp['ä¸€å¥è©±æè¿°(ä¸­)'] || ''}</div>
                <div class="hero-tags">
                    ${exp['åœ°å€'] ? `<span class="hero-tag">ğŸ“ ${exp['åœ°å€']}</span>` : ''}
                    ${exp['ä¸»è¦åˆ†é¡'] ? `<span class="hero-tag">${exp['ä¸»è¦åˆ†é¡']}</span>` : ''}
                    ${exp['é›£åº¦'] ? `<span class="hero-tag">â­ é›£åº¦: ${exp['é›£åº¦']}</span>` : ''}
                    <span class="hero-status">ğŸš§ ${exp['Status'] || 'æº–å‚™ä¸­'}</span>
                </div>
            `;
        }

        function startSlideShow() {
            clearInterval(slideInterval);
            if (slideCount <= 1) return;
            slideInterval = setInterval(() => changeSlide(1), 5000);
        }

        function changeSlide(direction) {
            const slides = document.querySelectorAll('.hero-slide');
            if (!slides.length) return;
            slides[currentSlide]?.classList.remove('active');
            currentSlide = (currentSlide + direction + slideCount) % slideCount;
            slides[currentSlide]?.classList.add('active');
        }

        function displayMap(exp) {
            const mapSection = document.getElementById('mapSection');

            // ä»¥ã€Œåœ°å€ã€ç”Ÿæˆ Google Maps å…§åµŒ
            const addr = (exp['åœ°å€'] || '').trim();

            if (!addr) {
                mapSection.style.display = 'none';
                return;
            }

            const iframeSrc = `https://www.google.com/maps?q=${encodeURIComponent(addr)}&output=embed`;

            const mapHTML = `
                <h2>ğŸ“ ä½ç½®è³‡è¨Š Location</h2>
                <div class="map-address">ğŸ“ ${addr}</div>
                <div class="map-container">
                    <iframe src="${iframeSrc}" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            `;
            mapSection.innerHTML = mapHTML;
        }

        function formatContent(content) {
            if (!content) return '<p>æº–å‚™ä¸­...</p>';
            const paragraphs = content.split('\n').filter(p => p.trim());
            return paragraphs.map(p => `<p>${p}</p>`).join('');
        }

        window.addEventListener('scroll', () => {
            const backToTop = document.querySelector('.back-to-top');
            if (window.pageYOffset > 300) backToTop.classList.add('show');
            else backToTop.classList.remove('show');
        });

        function scrollToTop() { window.scrollTo({ top: 0, behavior: 'smooth' }); }

        window.addEventListener('DOMContentLoaded', loadExperience);
    </script>
</body>
</html>
