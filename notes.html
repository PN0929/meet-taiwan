<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trail Notes 探路筆記 - Local Friends Taiwan</title>
  <meta name="description" content="Trail Notes is Local Friends Taiwan’s field notebook — on-site visits, behind-the-scenes stories, travel mindset, and updates on new hosts and experiences.">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --header-height: 56px;
      --max-width: 1100px;
      --green: #2D6A4F;
      --bg: #F7F5F2;
      --accent: #F4845F;
      --accent-soft: #E9C46A;
    }

    html, body { overflow-x: hidden; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif;
      line-height: 1.7;
      color: var(--green);
      background: var(--bg);
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      word-break: keep-all;
      overflow-wrap: anywhere;
    }
    h1, h2, h3 { text-wrap: balance; }
    img, video { max-width: 100%; height: auto; display: block; }

    /* ===== 共用 Header ===== */
    .site-header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--header-height);
      padding: 0 1.5rem;
      display: flex;
      align-items: center;
      gap: 1.25rem;
      background: rgba(247,245,242,0.98);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(45,106,79,0.06);
      z-index: 1100;
    }
    .brand {
      display: flex;
      flex-direction: column;
      justify-content: center;
      line-height: 1.2;
    }
    .brand a {
      text-decoration: none;
      color: var(--green);
    }
    .brand-en {
      font-weight: 700;
      letter-spacing: 0.11em;
      font-size: 0.78rem;
    }
    .brand-zh {
      opacity: 0.9;
      font-size: 0.78rem;
    }

    .main-nav {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .main-nav a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      border: 1.4px solid transparent;
      font-size: 0.86rem;
      font-weight: 700;
      color: var(--green);
      text-decoration: none;
      white-space: nowrap;
      transition: all 0.18s;
    }
    .main-nav a span.en { margin-right: 0.18rem; }
    .main-nav a:hover,
    .main-nav a.active {
      border-color: var(--accent-soft);
      background: #FFF7EB;
      box-shadow: 0 2px 8px rgba(233,196,106,.25);
      transform: translateY(-1px);
    }

    .nav-toggle {
      display: none;
      margin-left: auto;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1.4px solid var(--green);
      background: transparent;
      color: var(--green);
      font-size: 1.2rem;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .nav-toggle:hover { background: #E9C46A22; }
    .nav-toggle.open {
      background: var(--green);
      color: #F7F5F2;
      border-color: var(--green);
    }

    @media (max-width: 768px) {
      .site-header {
        padding: 0 1rem;
      }
      .brand-en,
      .brand-zh {
        font-size: 0.74rem;
      }

      .main-nav {
        position: fixed;
        top: var(--header-height);
        left: 0; right: 0;
        padding: 0.45rem 0.85rem 0.55rem;
        background: rgba(247,245,242,0.98);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(45,106,79,0.08);
        display: none;
        flex-wrap: nowrap;
        gap: 0.45rem;
        overflow-x: auto;
        white-space: nowrap;
        z-index: 1090;
      }
      .main-nav.open { display: flex; }
      .main-nav::-webkit-scrollbar { height: 3px; }
      .main-nav::-webkit-scrollbar-thumb {
        background: rgba(233,196,106,0.9);
        border-radius: 999px;
      }
      .main-nav a {
        padding: 0.35rem 0.8rem;
        font-size: 0.8rem;
        box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      }

      .nav-toggle { display: inline-flex; }
    }

    /* 回頂按鈕 */
    .back-to-top {
      position: fixed;
      right: 30px;
      bottom: 30px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #F4845F, #F4A261);
      color: #fff;
      border: none;
      border-radius: 50%;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(244,132,95,0.4);
      display: none;
      z-index: 1000;
      transition: transform 0.3s;
    }
    .back-to-top:hover { transform: translateY(-5px); }
    .back-to-top.show {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeInUp 0.5s ease;
    }

    /* Hero */
    .hero {
      padding: calc(var(--header-height) + 2.6rem) 1.5rem 1.4rem;
      background: #ffffff;
      border-bottom: 1px solid rgba(0,0,0,0.04);
    }
    .hero-inner {
      max-width: var(--max-width);
      margin: 0 auto;
    }
    .hero-kicker {
      font-size: 0.78rem;
      letter-spacing: 0.16em;
      text-transform: uppercase;
      color: #8d8d8d;
      margin-bottom: 0.3rem;
    }
    .hero-title {
      font-size: 2.1rem;
      font-weight: 800;
      color: var(--green);
      margin-bottom: 0.3rem;
    }
    .hero-sub-en {
      font-size: 1rem;
      color: #444;
      margin-bottom: 0.2rem;
      max-width: 760px;
    }
    .hero-sub-zh {
      font-size: 0.9rem;
      color: #888;
      max-width: 760px;
    }

    /* Filter bar */
    .filter-bar {
      max-width: var(--max-width);
      margin: 0.2rem auto 0;
      padding: 0.8rem 1.5rem 0.8rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      align-items: center;
      font-size: 0.9rem;
      color: #333;
    }
    .filter-label {
      font-weight: 700;
      font-size: 0.92rem;
    }
    .filter-select,
    .search-input {
      border-radius: 999px;
      border: 1px solid rgba(45,106,79,0.18);
      padding: 0.32rem 0.9rem;
      font-size: 0.86rem;
      outline: none;
      background: #fff;
      color: #333;
      min-width: 120px;
    }
    .search-input {
      flex: 1;
      min-width: 180px;
    }
    .search-input::placeholder {
      color: #aaa;
    }

    /* Cards layout */
    .page {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 0 1.5rem 3rem;
    }
    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.4rem;
      margin-top: 0.6rem;
    }

    .note-card {
      display: flex;
      flex-direction: column;
      background: #fff;
      border-radius: 14px;
      border: 1px solid #E5DECF;
      box-shadow: 0 4px 12px rgba(0,0,0,0.03);
      overflow: hidden;
      text-decoration: none;
      color: var(--green);
      transition: all 0.22s;
    }
    .note-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 22px rgba(45,106,79,0.14);
      border-color: var(--accent-soft);
    }

    .note-thumb-wrap {
      position: relative;
      width: 100%;
      padding-top: 55%;
      background: #EDE7DA;
      overflow: hidden;
    }
    .note-thumb {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s;
    }
    .note-card:hover .note-thumb {
      transform: scale(1.04);
    }

    .note-type-pill {
      position: absolute;
      left: 0.7rem;
      bottom: 0.6rem;
      padding: 0.18rem 0.6rem;
      border-radius: 999px;
      background: rgba(0,0,0,0.68);
      color: #fff;
      font-size: 0.7rem;
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }

    .note-body {
      padding: 0.85rem 0.95rem 0.9rem;
      display: flex;
      flex-direction: column;
      gap: 0.22rem;
      flex: 1;
    }
    .note-date {
      font-size: 0.76rem;
      color: #8a8a8a;
    }
    .note-title-en {
      font-size: 1rem;
      font-weight: 800;
      color: var(--green);
      line-height: 1.4;
    }
    .note-title-zh {
      font-size: 0.86rem;
      color: #777;
      line-height: 1.4;
    }
    .note-intro {
      font-size: 0.82rem;
      color: #555;
      margin-top: 0.1rem;
      line-height: 1.6;
    }
    .note-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.22rem;
      margin-top: 0.3rem;
    }
    .note-tag {
      padding: 0.14rem 0.5rem;
      border-radius: 999px;
      background: #F7F5F2;
      border: 1px solid #E9C46A;
      font-size: 0.7rem;
      color: #566;
    }
    .note-more {
      margin-top: auto;
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 0.22rem;
    }

    .empty {
      margin-top: 2rem;
      text-align: center;
      font-size: 0.95rem;
      color: #777;
    }

    .footer {
      background: linear-gradient(135deg,#2D6A4F,#40916C);
      color: #fff;
      text-align: center;
      padding: 2.4rem 2rem;
    }
    .footer a {
      color: #fff;
      text-decoration: none;
      font-weight: 700;
    }
    .footer a:hover { text-decoration: underline; }

    /* 動畫 */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(18px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      opacity: 0;
      transform: translateY(26px);
      transition: all 0.7s ease;
    }
    .fade-in.visible {
      opacity: 1;
      transform: translateY(0);
    }

    @media (max-width: 768px) {
      .hero {
        padding: calc(var(--header-height) + 1.8rem) 1.25rem 1.2rem;
      }
      .hero-title {
        font-size: 1.8rem;
      }
      .hero-sub-en {
        font-size: 0.95rem;
      }
      .hero-sub-zh {
        font-size: 0.84rem;
      }
      .filter-bar {
        padding: 0.6rem 1.25rem 0.6rem;
        gap: 0.45rem;
      }
      .filter-label {
        font-size: 0.88rem;
      }
      .filter-select,
      .search-input {
        font-size: 0.8rem;
        padding: 0.26rem 0.75rem;
      }
      .page {
        padding: 0 1.25rem 2.4rem;
      }
      .cards-grid {
        gap: 1rem;
      }
      .back-to-top {
        right: 16px;
        bottom: 16px;
        width: 48px;
        height: 48px;
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="brand">
      <a href="index.html">
        <div class="brand-en">LOCAL FRIENDS TAIWAN</div>
        <div class="brand-zh">台灣在地連線</div>
      </a>
    </div>
    <nav class="main-nav" id="mainNav">
      <a href="experiences.html"><span class="en">Experiences</span><span class="zh">體驗列表</span></a>
      <a href="about.html"><span class="en">About</span><span class="zh">關於我們</span></a>
      <a href="faq.html"><span class="en">FAQ</span><span class="zh">常見問題</span></a>
      <a href="hosts.html"><span class="en">For Hosts</span><span class="zh">成為在地朋友</span></a>
      <a href="notes.html" class="active"><span class="en">Trail Notes</span><span class="zh">探路筆記</span></a>
      <a href="contact.html"><span class="en">Contact</span><span class="zh">聯繫我們</span></a>
    </nav>
    <button class="nav-toggle" id="navToggle" aria-label="切換導覽選單">☰</button>
  </header>

  <!-- Back to top -->
  <button class="back-to-top" onclick="scrollToTop()">↑</button>

  <!-- Hero -->
  <section class="hero">
    <div class="hero-inner fade-in">
      <div class="hero-kicker">TRAIL NOTES · FIELD NOTEBOOK</div>
      <h1 class="hero-title">Trail Notes 探路筆記</h1>
      <p class="hero-sub-en">
        Trail Notes is Local Friends Taiwan’s field notebook: on-the-ground visits, slow conversations,
        trust-building, and reflections with communities across Taiwan.
      </p>
      <p class="hero-sub-zh">
        Trail Notes 是 Local Friends Taiwan 的「實地筆記本」：每一篇都來自我們親自拜訪、對話、慢慢建立信任後的紀錄與思考。
        在這裡你會看到 Field Reports 探訪紀錄、Behind the Hosts 幕後故事、Travel Mindset 旅人心態，以及 Updates 新上架與調整。
      </p>
    </div>
  </section>

  <!-- Filter -->
  <section class="filter-bar fade-in">
    <span class="filter-label">Filter / Search：</span>
    <select id="typeFilter" class="filter-select">
      <option value="">All Types</option>
    </select>
    <input id="searchInput" class="search-input" type="search"
           placeholder="Search by title / tag / keyword 搜尋標題與關鍵字">
  </section>

  <!-- Cards -->
  <main class="page fade-in">
    <div id="cards" class="cards-grid"></div>
    <div id="emptyState" class="empty" style="display:none;">
      目前沒有符合條件的筆記。<br>
      No notes match your current filters.
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p style="font-size:1.2rem;margin-bottom:0.6rem;"><strong>Local Friends Taiwan 台灣在地連線</strong></p>
    <p>Your local friend in Taiwan | 當你需要一位台灣在地的朋友</p>
    <p style="margin-top:1.2rem;opacity:0.9;font-size:0.95rem;">
      © 2025 Local Friends Taiwan. Independent Information Platform.
    </p>
  </footer>

  <script>
    const SHEET_ID  = '1icnZhegrhiUdaWz_BgQK0CQ_oueDhPhZgnl3opy9PJs';
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;

    let notes = [];

    document.addEventListener('DOMContentLoaded', () => {
      // Nav toggle
      const navToggle = document.getElementById('navToggle');
      const mainNav = document.getElementById('mainNav');
      if (navToggle && mainNav) {
        navToggle.addEventListener('click', () => {
          const isOpen = mainNav.classList.toggle('open');
          navToggle.classList.toggle('open', isOpen);
        });
        mainNav.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', () => {
            if (mainNav.classList.contains('open')) {
              mainNav.classList.remove('open');
              navToggle.classList.remove('open');
            }
          });
        });
      }

      // 淡入動畫（跟 about.html 同邏輯）
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) entry.target.classList.add('visible');
        });
      }, { threshold: 0.12, rootMargin: '0px 0px -60px 0px' });

      document.querySelectorAll('.fade-in').forEach((el, i) => {
        el.style.transitionDelay = `${i * 0.06}s`;
        observer.observe(el);
      });

      loadNotes();
    });

    async function loadNotes(){
      try{
        const resp = await fetch(SHEET_URL);
        const txt = await resp.text();
        const rows = parseCSV(txt);
        const headers = rows[0];
        const data = rows.slice(1);

        notes = data.map(r => {
          const o = {};
          headers.forEach((h,i)=>{ o[h.trim()] = (r[i] || '').trim(); });
          return o;
        }).filter(o => {
          const status = (o['Status'] || o['status'] || o['狀態'] || '').trim();
          return status === '已發佈';
        });

        // sort by Date desc if exists
        notes.sort((a,b)=>{
          const da = new Date(a['Date'] || a['date'] || 0);
          const db = new Date(b['Date'] || b['date'] || 0);
          return db - da;
        });

        buildFilters(notes);
        renderCards();
      }catch(err){
        console.error(err);
        document.getElementById('cards').innerHTML =
          `<div class="empty">⚠️ 無法載入 Trail Notes。Error loading notes.</div>`;
      }
    }

    function parseCSV(csv){
      const lines = csv.split('\n').filter(l => l.trim().length > 0);
      return lines.map(line => {
        const values = [];
        let cur = '';
        let inQ = false;
        for (let i=0;i<line.length;i++){
          const ch = line[i];
          if (ch === '"') {
            if (inQ && line[i+1] === '"'){ cur += '"'; i++; }
            else { inQ = !inQ; }
          } else if (ch === ',' && !inQ) {
            values.push(cur);
            cur = '';
          } else {
            cur += ch;
          }
        }
        values.push(cur);
        return values;
      });
    }

    function buildFilters(list){
      const typeSet = new Set();
      list.forEach(n => {
        const type = (n['Type'] || n['type'] || '').trim();
        if (type) typeSet.add(type);
      });
      const typeSel = document.getElementById('typeFilter');
      typeSet.forEach(t => {
        const opt = document.createElement('option');
        opt.value = t;
        opt.textContent = t;
        typeSel.appendChild(opt);
      });
      typeSel.addEventListener('change', renderCards);
      document.getElementById('searchInput').addEventListener('input', renderCards);
    }

    function mapTypeLabel(type){
      const map = {
        'Field Report': 'Field Report 探訪紀錄',
        'Behind the Hosts': 'Behind the Hosts 幕後故事',
        'Travel Mindset': 'Travel Mindset 旅人心態',
        'Updates': 'Updates 新消息'
      };
      return map[type] || type || '';
    }

    function renderCards(){
      const cards = document.getElementById('cards');
      const empty = document.getElementById('emptyState');
      cards.innerHTML = '';

      const typeFilter = document.getElementById('typeFilter').value;
      const q = document.getElementById('searchInput').value.trim().toLowerCase();

      const filtered = notes.filter(n => {
        if (typeFilter && (n['Type']||'').trim() !== typeFilter) return false;

        if (q) {
          const text = [
            n['Title_en'], n['Title_zh'],
            n['Intro_en'], n['Intro_zh'],
            n['Tags']
          ].join(' ').toLowerCase();
          if (!text.includes(q)) return false;
        }
        return true;
      });

      if (!filtered.length){
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      filtered.forEach(n => {
        const id = (n['ID'] || n['Id'] || '').trim();
        if (!id) return;
        const href = `notes-detail.html?id=${encodeURIComponent(id)}`;

        const titleEn = n['Title_en'] || '';
        const titleZh = n['Title_zh'] || '';
        const introEn = n['Intro_en'] || '';
        const introZh = n['Intro_zh'] || '';
        const type = n['Type'] || '';
        const date = n['Date'] || '';
        const cover = n['CoverImage'] || n['Cover'] || '';
        const tags = (n['Tags'] || '').split(/[,\s、]+/).filter(Boolean).slice(0,4);

        const a = document.createElement('a');
        a.className = 'note-card';
        a.href = href;

        a.innerHTML = `
          <div class="note-thumb-wrap">
            ${cover
              ? `<img src="${cover}" alt="${titleEn || titleZh || 'Trail Note'}"
                     class="note-thumb"
                     loading="lazy"
                     onerror="this.style.display='none';this.parentElement.style.background='#EDE7DA';">`
              : ``
            }
            ${type
              ? `<div class="note-type-pill">${mapTypeLabel(type)}</div>`
              : ``
            }
          </div>
          <div class="note-body">
            ${date ? `<div class="note-date">${date}</div>` : ``}
            <div class="note-title-en">${titleEn || 'Untitled Trail Note'}</div>
            ${titleZh ? `<div class="note-title-zh">${titleZh}</div>` : ``}
            ${introEn
              ? `<div class="note-intro">${introEn}</div>`
              : introZh
                ? `<div class="note-intro" style="color:#777;">${introZh}</div>`
                : ``
            }
            ${tags.length
              ? `<div class="note-tags">
                   ${tags.map(t=>`<span class="note-tag">${t}</span>`).join('')}
                 </div>`
              : ``
            }
            <div class="note-more">Read note 讀取全文 →</div>
          </div>
        `;
        cards.appendChild(a);
      });
    }

    // Back to top
    window.addEventListener('scroll', () => {
      const b = document.querySelector('.back-to-top');
      if (!b) return;
      if (window.pageYOffset > 300) b.classList.add('show');
      else b.classList.remove('show');
    });
    function scrollToTop(){
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  </script>
</body>
</html>
