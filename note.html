<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trail Notes æ¢è·¯ç­†è¨˜ - Local Friends Taiwan | å°ç£åœ¨åœ°é€£ç·š</title>
  <meta name="description" content="Stories behind the hosts, field notes from communities, and reflections on respectful travel in Taiwan." />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --header-height: 56px;
      --max-width: 1100px;
      --green: #2D6A4F;
      --bg: #F7F5F2;
      --accent: #F4845F;
      --accent-soft: #E9C46A;
    }

    html, body { overflow-x: hidden; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif;
      line-height: 1.7;
      color: var(--green);
      background: var(--bg);
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      word-break: keep-all;
      overflow-wrap: anywhere;
    }
    h1, h2, h3 { text-wrap: balance; }
    img, video { max-width: 100%; height: auto; display: block; }

    /* ===== å…±ç”¨ Header ===== */
    .site-header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--header-height);
      padding: 0 1.5rem;
      display: flex;
      align-items: center;
      gap: 1.25rem;
      background: rgba(247, 245, 242, 0.98);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(45, 106, 79, 0.06);
      z-index: 1100;
    }
    .brand {
      display: flex;
      flex-direction: column;
      justify-content: center;
      line-height: 1.2;
    }
    .brand a {
      text-decoration: none;
      color: var(--green);
    }
    .brand-en {
      font-weight: 700;
      letter-spacing: 0.11em;
      font-size: 0.78rem;
    }
    .brand-zh {
      opacity: 0.9;
      font-size: 0.78rem;
    }

    .main-nav {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .main-nav a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      border: 1.4px solid transparent;
      font-size: 0.86rem;
      font-weight: 700;
      color: var(--green);
      text-decoration: none;
      white-space: nowrap;
      transition: all 0.18s;
    }
    .main-nav a span.en { margin-right: 0.18rem; }
    .main-nav a:hover,
    .main-nav a.active {
      border-color: var(--accent-soft);
      background: #FFF7EB;
      box-shadow: 0 2px 8px rgba(233,196,106,.25);
      transform: translateY(-1px);
    }

    .nav-toggle {
      display: none;
      margin-left: auto;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1.4px solid var(--green);
      background: transparent;
      color: var(--green);
      font-size: 1.2rem;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .nav-toggle:hover { background: #E9C46A22; }
    .nav-toggle.open {
      background: var(--green);
      color: #F7F5F2;
      border-color: var(--green);
    }

    @media (max-width: 768px) {
      .site-header {
        padding: 0 1rem;
        height: var(--header-height);
      }
      .brand-en,
      .brand-zh { font-size: 0.74rem; }

      .main-nav {
        position: fixed;
        top: var(--header-height);
        left: 0; right: 0;
        padding: 0.45rem 0.85rem 0.55rem;
        background: rgba(247, 245, 242, 0.98);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(45,106,79,0.08);
        display: none;
        flex-wrap: nowrap;
        gap: 0.45rem;
        overflow-x: auto;
        white-space: nowrap;
        z-index: 1090;
      }
      .main-nav.open { display: flex; }
      .main-nav::-webkit-scrollbar { height: 3px; }
      .main-nav::-webkit-scrollbar-thumb {
        background: rgba(233,196,106,0.9);
        border-radius: 999px;
      }
      .main-nav a {
        padding: 0.35rem 0.8rem;
        font-size: 0.8rem;
        box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      }

      .nav-toggle { display: inline-flex; }
    }

    /* å›é ‚æŒ‰éˆ• */
    .back-to-top {
      position: fixed;
      right: 30px;
      bottom: 30px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #F4845F, #F4A261);
      color: #fff;
      border: none;
      border-radius: 50%;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(244,132,95,0.4);
      display: none;
      z-index: 1000;
      transition: transform 0.3s;
    }
    .back-to-top:hover { transform: translateY(-5px); }
    .back-to-top.show {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeInUp 0.5s ease;
    }

    /* Hero */
    .hero {
      padding: calc(var(--header-height) + 2.6rem) 1.5rem 1.6rem;
      background: linear-gradient(
        135deg,
        rgba(45,106,79,0.98),
        rgba(64,145,108,0.96)
      );
      color: #fff;
    }
    .hero-inner {
      max-width: var(--max-width);
      margin: 0 auto;
    }
    .hero-kicker {
      font-size: 0.78rem;
      text-transform: uppercase;
      letter-spacing: 0.16em;
      opacity: 0.9;
      margin-bottom: 0.25rem;
      font-weight: 600;
    }
    .hero-title {
      font-size: 2.1rem;
      font-weight: 800;
      margin-bottom: 0.25rem;
    }
    .hero-sub {
      font-size: 0.98rem;
      opacity: 0.96;
      max-width: 720px;
    }

    /* Tabs / Filters row */
    .tabs-bar {
      max-width: var(--max-width);
      margin: 0.9rem auto 0;
      padding: 0.45rem 0 0.8rem;
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      align-items: center;
      font-size: 0.82rem;
      color: #fdfdfd;
    }
    .tab-label {
      font-weight: 700;
      margin-right: 0.2rem;
    }
    .tab-pill {
      padding: 0.28rem 0.7rem;
      border-radius: 999px;
      border: 1px solid transparent;
      background: rgba(255,255,255,0.14);
      color: #fff;
      font-size: 0.78rem;
      cursor: pointer;
      transition: all 0.18s;
      white-space: nowrap;
    }
    .tab-pill:hover {
      background: rgba(255,255,255,0.22);
    }
    .tab-pill.active {
      background: #fff;
      color: var(--green);
      border-color: var(--accent-soft);
      box-shadow: 0 2px 8px rgba(0,0,0,0.16);
    }
    .search-input {
      margin-left: auto;
      padding: 0.28rem 0.75rem;
      border-radius: 999px;
      border: none;
      background: rgba(255,255,255,0.16);
      color: #fff;
      font-size: 0.78rem;
      outline: none;
      min-width: 140px;
    }
    .search-input::placeholder {
      color: rgba(255,255,255,0.82);
    }

    /* Content layout */
    .page {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 1.8rem 1.5rem 3rem;
    }

    .section-intro {
      font-size: 0.92rem;
      color: #4f6f5b;
      margin-bottom: 1.4rem;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.4rem;
    }

    .note-card {
      position: relative;
      background: #fff;
      border-radius: 14px;
      border: 1.5px solid #E5DECF;
      box-shadow: 0 4px 14px rgba(0,0,0,0.04);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: all 0.22s;
      text-decoration: none;
      color: var(--green);
    }
    .note-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(45,106,79,0.14);
      border-color: var(--accent-soft);
    }

    .note-thumb-wrap {
      position: relative;
      width: 100%;
      padding-top: 56%;
      overflow: hidden;
      background: #e5e2da;
    }
    .note-thumb {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.35s;
    }
    .note-card:hover .note-thumb {
      transform: scale(1.04);
    }
    .note-tag-top {
      position: absolute;
      left: 0.7rem;
      bottom: 0.55rem;
      padding: 0.18rem 0.6rem;
      border-radius: 999px;
      background: rgba(0,0,0,0.64);
      color: #fff;
      font-size: 0.7rem;
      display: inline-flex;
      gap: 0.22rem;
      align-items: center;
    }

    .note-body {
      padding: 0.85rem 0.95rem 0.95rem;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.22rem;
    }
    .note-title-en {
      font-size: 0.9rem;
      font-weight: 800;
      color: var(--green);
      line-height: 1.35;
    }
    .note-title-zh {
      font-size: 0.8rem;
      font-weight: 600;
      color: #4a7b60;
      line-height: 1.3;
    }
    .note-meta {
      font-size: 0.7rem;
      color: #8a8a8a;
      display: flex;
      flex-wrap: wrap;
      gap: 0.35rem;
      margin-top: 0.1rem;
    }
    .note-excerpt {
      font-size: 0.8rem;
      color: #555;
      margin-top: 0.2rem;
      line-height: 1.6;
    }
    .note-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.22rem;
      margin-top: 0.3rem;
    }
    .note-tag {
      padding: 0.16rem 0.46rem;
      border-radius: 999px;
      background: #F7F5F2;
      border: 1px solid #E9C46A;
      font-size: 0.65rem;
      color: #566;
    }
    .note-more {
      margin-top: auto;
      font-size: 0.78rem;
      font-weight: 700;
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 0.18rem;
    }

    .empty {
      margin-top: 2rem;
      font-size: 0.95rem;
      color: #777;
      text-align: center;
    }

    .footer {
      background: linear-gradient(135deg,#2D6A4F,#40916C);
      color: #fff;
      text-align: center;
      padding: 2.4rem 2rem;
    }
    .footer a {
      color: #fff;
      text-decoration: none;
      font-weight: 700;
    }
    .footer a:hover { text-decoration: underline; }

    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(18px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    @media (max-width: 768px) {
      .hero {
        padding: calc(var(--header-height) + 1.6rem) 1rem 1.2rem;
      }
      .hero-title {
        font-size: 1.7rem;
      }
      .hero-sub {
        font-size: 0.9rem;
      }
      .tabs-bar {
        padding: 0.35rem 0 0.7rem;
        gap: 0.35rem;
        font-size: 0.78rem;
      }
      .tab-pill {
        padding: 0.24rem 0.65rem;
        font-size: 0.74rem;
      }
      .search-input {
        font-size: 0.74rem;
        padding: 0.24rem 0.65rem;
        min-width: 120px;
      }
      .page {
        padding: 1.6rem 1rem 2.4rem;
      }
      .back-to-top {
        right: 16px;
        bottom: 16px;
        width: 48px;
        height: 48px;
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="brand">
      <a href="index.html">
        <div class="brand-en">LOCAL FRIENDS TAIWAN</div>
        <div class="brand-zh">å°ç£åœ¨åœ°é€£ç·š</div>
      </a>
    </div>
    <nav class="main-nav" id="mainNav">
      <a href="experiences.html"><span class="en">Experiences</span><span class="zh">é«”é©—åˆ—è¡¨</span></a>
      <a href="about.html"><span class="en">About</span><span class="zh">é—œæ–¼æˆ‘å€‘</span></a>
      <a href="faq.html"><span class="en">FAQ</span><span class="zh">å¸¸è¦‹å•é¡Œ</span></a>
      <a href="hosts.html"><span class="en">For Hosts</span><span class="zh">æˆç‚ºåœ¨åœ°æœ‹å‹</span></a>
      <a href="notes.html" class="active"><span class="en">Trail Notes</span><span class="zh">æ¢è·¯ç­†è¨˜</span></a>
      <a href="contact.html"><span class="en">Contact</span><span class="zh">è¯ç¹«æˆ‘å€‘</span></a>
    </nav>
    <button class="nav-toggle" id="navToggle" aria-label="åˆ‡æ›å°è¦½é¸å–®">â˜°</button>
  </header>

  <!-- Back to top -->
  <button class="back-to-top" onclick="scrollToTop()">â†‘</button>

  <!-- Hero + Tabs -->
  <section class="hero">
    <div class="hero-inner">
      <div class="hero-kicker">TRAIL NOTES Â· æ¢è·¯ç­†è¨˜</div>
      <h1 class="hero-title">Stories from the road & behind the scenes</h1>
      <p class="hero-sub">
        Field notes from visits, stories of how we met our hosts, reflections on respectful travel,
        and updates from communities across Taiwan. All to help you connect more thoughtfully.
      </p>
    </div>
    <div class="tabs-bar">
      <span class="tab-label">Browse byï¼š</span>
      <button class="tab-pill active" data-category="">All å…¨éƒ¨</button>
      <button class="tab-pill" data-category="Field Notes">Field Notes æ¢è¨ªç´€éŒ„</button>
      <button class="tab-pill" data-category="Behind the Hosts">Behind the Hosts å¹•å¾Œæ•…äº‹</button>
      <button class="tab-pill" data-category="Good Travel">Good Travel Guides å¥½å¥½æ—…è¡Œ</button>
      <button class="tab-pill" data-category="News">News / Updates æ–°æ¶ˆæ¯</button>
      <input id="searchInput" class="search-input" type="search"
             placeholder="Search notes æœå°‹é—œéµå­—">
    </div>
  </section>

  <!-- Content -->
  <main class="page">
    <p class="section-intro">
      æ¯ä¸€ç¯‡æ¢è·¯ç­†è¨˜ï¼Œéƒ½æ˜¯å¯¦éš›èµ°è¨ªã€å°è©±èˆ‡è§€å¯Ÿçš„ç´€éŒ„ã€‚<br>
      No paid placements, no advertorials â€” just transparent notes to help you understand the stories,
      values, and communities behind each experience.
    </p>

    <div id="notesGrid" class="cards-grid"></div>
    <div id="emptyState" class="empty" style="display:none;">
      æš«æ™‚æ²’æœ‰ç¬¦åˆæ¢ä»¶çš„æ–‡ç« ã€‚<br>
      No notes match your current filters.
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p style="font-size:1.2rem;margin-bottom:0.6rem;"><strong>Local Friends Taiwan å°ç£åœ¨åœ°é€£ç·š</strong></p>
    <p>Your local friend in Taiwan | ç•¶ä½ éœ€è¦ä¸€ä½å°ç£åœ¨åœ°çš„æœ‹å‹</p>
    <p style="margin-top:0.8rem;">
      <a href="https://github.com/PN0929/meet-taiwan" target="_blank">ğŸ“‚ GitHub Project</a>
    </p>
    <p style="margin-top:1.2rem;opacity:0.9;font-size:0.95rem;">
      Â© 2025 Local Friends Taiwan. Independent Information Platform.
    </p>
  </footer>

  <script>
    // === CONFIG ===
    // TODO: æ›æˆä½ çœŸæ­£çš„ Trail Notes å°ˆç”¨ Google Sheet ID
    const NOTES_SHEET_ID = 'PASTE_YOUR_NOTES_SHEET_ID_HERE';
    const NOTES_SHEET_URL = `https://docs.google.com/spreadsheets/d/${NOTES_SHEET_ID}/gviz/tq?tqx=out:csv`;

    // Nav toggle (mobile)
    document.addEventListener('DOMContentLoaded', () => {
      const navToggle = document.getElementById('navToggle');
      const mainNav = document.getElementById('mainNav');
      if (navToggle && mainNav) {
        navToggle.addEventListener('click', () => {
          const isOpen = mainNav.classList.toggle('open');
          navToggle.classList.toggle('open', isOpen);
        });
        mainNav.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', () => {
            if (mainNav.classList.contains('open')) {
              mainNav.classList.remove('open');
              navToggle.classList.remove('open');
            }
          });
        });
      }

      loadNotes();
    });

    let notes = [];

    async function loadNotes() {
      try {
        const resp = await fetch(NOTES_SHEET_URL);
        const txt = await resp.text();
        const rows = parseCSV(txt);
        const headers = rows[0];
        const data = rows.slice(1);

        // å»ºè­°æ¬„ä½ï¼ˆå¯ä¾ä½ å¯¦éš› sheet æ¬„ä½åç¨±èª¿æ•´ï¼‰ï¼š
        // ID, Title EN, Title ZH, Category, Type, Image, Doc Link, Summary, Tags, Date, Publish
        notes = data.map(r => {
          const o = {};
          headers.forEach((h, i) => o[h] = r[i] || '');
          return o;
        }).filter(o => {
          const flag = (o['Publish'] || o['é¡¯ç¤º'] || '').toString().trim().toLowerCase();
          return flag !== 'no' && flag !== 'hide' && flag !== '0';
        });

        renderNotes();
      } catch (err) {
        console.error(err);
        const grid = document.getElementById('notesGrid');
        grid.innerHTML = `<div class="empty">âš ï¸ ç„¡æ³•è¼‰å…¥æ¢è·¯ç­†è¨˜åˆ—è¡¨ Error loading notes.</div>`;
      }

      // ç¶å®š tab / search
      document.querySelectorAll('.tab-pill').forEach(btn => {
        btn.addEventListener('click', () => {
          document.querySelectorAll('.tab-pill').forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          renderNotes();
        });
      });
      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', renderNotes);
    }

    function parseCSV(csv) {
      const lines = csv.split('\n');
      return lines.map(line => {
        const values = [];
        let cur = '';
        let inQ = false;
        for (const ch of line) {
          if (ch === '"') inQ = !inQ;
          else if (ch === ',' && !inQ) {
            values.push(cur.trim());
            cur = '';
          } else {
            cur += ch;
          }
        }
        values.push(cur.trim());
        return values;
      });
    }

    function getCover(note) {
      const raw = (note['Image'] || note['å°é¢åœ–'] || '').replace(/ï¼Œ/g, ',');
      const links = raw.split(/[,\s]+/).map(s => s.trim()).filter(Boolean);
      return links[0] || '';
    }

    function getCategory(note) {
      return (note['Category'] || note['é¡åˆ¥'] || '').trim();
    }

    function getLink(note) {
      // è‹¥æœªä¾†æ”¹æˆå…§é ï¼Œå¯æ”¹ï¼š`trail-note-detail.html?id=...`
      const doc = (note['Doc Link'] || note['é€£çµ'] || '').trim();
      return doc || '#';
    }

    function renderNotes() {
      const grid = document.getElementById('notesGrid');
      const empty = document.getElementById('emptyState');
      grid.innerHTML = '';

      const activeTab = document.querySelector('.tab-pill.active');
      const catFilter = activeTab ? (activeTab.dataset.category || '') : '';
      const q = document.getElementById('searchInput').value.trim().toLowerCase();

      const filtered = notes.filter(note => {
        const cat = getCategory(note);

        if (catFilter) {
          if (!cat || !cat.toLowerCase().includes(catFilter.toLowerCase())) {
            return false;
          }
        }

        if (q) {
          const blob = [
            note['Title EN'], note['Title ZH'],
            note['Summary'], note['Tags'], cat,
            note['å…§å®¹'], note['Notes']
          ].join(' ').toLowerCase();
          if (!blob.includes(q)) return false;
        }

        return true;
      });

      if (!filtered.length) {
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      filtered.forEach(note => {
        const cover = getCover(note);
        const cat = getCategory(note);
        const url = getLink(note);

        const titleEn = (note['Title EN'] || '').trim();
        const titleZh = (note['Title ZH'] || '').trim();
        const summary = (note['Summary'] || '').trim();
        const tags = (note['Tags'] || '').split(/[,\sã€]+/).filter(Boolean).slice(0, 4);
        const date = (note['Date'] || note['æ—¥æœŸ'] || '').trim();

        const card = document.createElement('a');
        card.className = 'note-card';
        card.href = url || 'javascript:void(0)';
        card.target = url && url.startsWith('http') ? '_blank' : '_self';
        card.rel = url && url.startsWith('http') ? 'noopener' : '';

        card.innerHTML = `
          <div class="note-thumb-wrap">
            ${cover
              ? `<img src="${cover}" alt="${titleEn || titleZh || 'Trail note'}"
                       class="note-thumb"
                       loading="lazy"
                       onerror="this.style.display='none';this.parentElement.style.background='#e5e5e5';">`
              : ``
            }
            ${cat
              ? `<div class="note-tag-top">
                    <span>âœï¸ ${cat}</span>
                 </div>`
              : ``}
          </div>
          <div class="note-body">
            <div class="note-title-en">${titleEn || 'Untitled Trail Note'}</div>
            ${titleZh ? `<div class="note-title-zh">${titleZh}</div>` : ``}
            <div class="note-meta">
              ${date ? `<span>ğŸ“… ${date}</span>` : ``}
              ${note['Host'] ? `<span>ğŸ¤ Hostï¼š${note['Host']}</span>` : ``}
              ${note['Location'] ? `<span>ğŸ“ ${note['Location']}</span>` : ``}
            </div>
            ${summary
              ? `<div class="note-excerpt">${summary}</div>`
              : ``}
            <div class="note-tags">
              ${tags.map(t => `<span class="note-tag">${t}</span>`).join('')}
            </div>
            <div class="note-more">
              Read more äº†è§£æ›´å¤š â†’
            </div>
          </div>
        `;

        grid.appendChild(card);
      });
    }

    // Back to top
    window.addEventListener('scroll', () => {
      const b = document.querySelector('.back-to-top');
      if (!b) return;
      if (window.pageYOffset > 300) b.classList.add('show');
      else b.classList.remove('show');
    });
    function scrollToTop() {
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  </script>
</body>
</html>
