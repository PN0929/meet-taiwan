<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Experiences é«”é©—åˆ—è¡¨ - Local Friends Taiwan | å°ç£åœ¨åœ°é€£ç·š</title>
  <meta name="description" content="Browse curated local experiences in Taiwan. Real people, real communities, no scripted tours.">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --header-height: 56px;
      --max-width: 1100px;
      --green: #2D6A4F;
      --bg: #F7F5F2;
      --accent: #F4845F;
      --accent-soft: #E9C46A;
    }

    html, body { overflow-x: hidden; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "Microsoft JhengHei", sans-serif;
      line-height: 1.7;
      color: var(--green);
      background: var(--bg);
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
      word-break: keep-all;
      overflow-wrap: anywhere;
    }
    h1, h2, h3 { text-wrap: balance; }
    img, video { max-width: 100%; height: auto; display: block; }

    /* ===== å…±ç”¨ Header ===== */
    .site-header {
      position: fixed;
      top: 0; left: 0; right: 0;
      height: var(--header-height);
      padding: 0 1.5rem;
      display: flex;
      align-items: center;
      gap: 1.25rem;
      background: rgba(247, 245, 242, 0.98);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(45, 106, 79, 0.06);
      z-index: 1100;
    }
    .brand {
      display: flex;
      flex-direction: column;
      justify-content: center;
      line-height: 1.2;
    }
    .brand a {
      text-decoration: none;
      color: var(--green);
    }
    .brand-en {
      font-weight: 700;
      letter-spacing: 0.11em;
      font-size: 0.78rem;
    }
    .brand-zh {
      opacity: 0.9;
      font-size: 0.78rem;
    }

    .main-nav {
      margin-left: auto;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    .main-nav a {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 0.4rem 0.9rem;
      border-radius: 999px;
      border: 1.4px solid transparent;
      font-size: 0.86rem;
      font-weight: 700;
      color: var(--green);
      text-decoration: none;
      white-space: nowrap;
      transition: all 0.18s;
    }
    .main-nav a span.en { margin-right: 0.18rem; }
    .main-nav a:hover,
    .main-nav a.active {
      border-color: var(--accent-soft);
      background: #FFF7EB;
      box-shadow: 0 2px 8px rgba(233,196,106,.25);
      transform: translateY(-1px);
    }

    .nav-toggle {
      display: none;
      margin-left: auto;
      width: 34px;
      height: 34px;
      border-radius: 999px;
      border: 1.4px solid var(--green);
      background: transparent;
      color: var(--green);
      font-size: 1.2rem;
      cursor: pointer;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }
    .nav-toggle:hover { background: #E9C46A22; }
    .nav-toggle.open {
      background: var(--green);
      color: #F7F5F2;
      border-color: var(--green);
    }

    @media (max-width: 768px) {
      .site-header {
        padding: 0 1rem;
        height: var(--header-height);
      }
      .brand-en,
      .brand-zh {
        font-size: 0.74rem;
      }

      .main-nav {
        position: fixed;
        top: var(--header-height);
        left: 0; right: 0;
        padding: 0.45rem 0.85rem 0.55rem;
        background: rgba(247, 245, 242, 0.98);
        backdrop-filter: blur(10px);
        border-bottom: 1px solid rgba(45,106,79,0.08);
        display: none;
        flex-wrap: nowrap;
        gap: 0.45rem;
        overflow-x: auto;
        white-space: nowrap;
        z-index: 1090;
      }
      .main-nav.open { display: flex; }
      .main-nav::-webkit-scrollbar { height: 3px; }
      .main-nav::-webkit-scrollbar-thumb {
        background: rgba(233,196,106,0.9);
        border-radius: 999px;
      }
      .main-nav a {
        padding: 0.35rem 0.8rem;
        font-size: 0.8rem;
        box-shadow: 0 1px 4px rgba(0,0,0,0.04);
      }

      .nav-toggle { display: inline-flex; }
    }

    /* å›é ‚æŒ‰éˆ• */
    .back-to-top {
      position: fixed;
      right: 30px;
      bottom: 30px;
      width: 60px;
      height: 60px;
      background: linear-gradient(135deg, #F4845F, #F4A261);
      color: #fff;
      border: none;
      border-radius: 50%;
      font-size: 1.5rem;
      cursor: pointer;
      box-shadow: 0 4px 20px rgba(244,132,95,0.4);
      display: none;
      z-index: 1000;
      transition: transform 0.3s;
    }
    .back-to-top:hover { transform: translateY(-5px); }
    .back-to-top.show {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeInUp 0.5s ease;
    }

    /* Hero */
    .hero {
      padding: calc(var(--header-height) + 2.6rem) 1.5rem 1.2rem;
      background: linear-gradient(
        135deg,
        rgba(45,106,79,0.98),
        rgba(64,145,108,0.96)
      );
      color: #fff;
    }
    .hero-inner {
      max-width: var(--max-width);
      margin: 0 auto;
    }
    .hero-title {
      font-size: 2.1rem;
      font-weight: 800;
      margin-bottom: 0.3rem;
    }
    .hero-sub {
      font-size: 1rem;
      opacity: 0.96;
      max-width: 640px;
    }

    /* Filter bar */
    .filter-bar {
      max-width: var(--max-width);
      margin: 0.9rem auto 0;
      padding: 0.7rem 0;
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      align-items: center;
      color: #fdfdfd;
      font-size: 0.9rem;
      opacity: 0.98;
    }
    .filter-label {
      font-weight: 700;
      font-size: 0.95rem;
    }
    .filter-select,
    .search-input {
      border-radius: 999px;
      border: none;
      padding: 0.34rem 0.9rem;
      font-size: 0.85rem;
      outline: none;
      background: rgba(255,255,255,0.16);
      color: #fff;
      min-width: 110px;
    }
    .filter-select option { color: #222; }
    .search-input::placeholder { color: rgba(255,255,255,0.9); }
    .search-input {
      flex: 1;
      max-width: 320px;
    }

    /* Cards */
    .page {
      max-width: var(--max-width);
      margin: 0 auto;
      padding: 1.8rem 1.5rem 3rem;
    }

    .cards-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.4rem;
    }

    .exp-card {
      position: relative;
      background: #fff;
      border-radius: 14px;
      border: 1.5px solid #E5DECF;
      box-shadow: 0 4px 14px rgba(0,0,0,0.04);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      transition: all 0.22s;
      text-decoration: none;
      color: var(--green);
    }
    .exp-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px rgba(45,106,79,0.14);
      border-color: var(--accent-soft);
    }

    .exp-thumb-wrap {
      position: relative;
      width: 100%;
      padding-top: 62%;
      overflow: hidden;
      background: #ddd;
    }
    .exp-thumb {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.35s;
    }
    .exp-card:hover .exp-thumb {
      transform: scale(1.04);
    }
    .exp-tag-top {
      position: absolute;
      left: 0.7rem;
      bottom: 0.6rem;
      padding: 0.22rem 0.6rem;
      border-radius: 999px;
      background: rgba(0,0,0,0.6);
      color: #fff;
      font-size: 0.7rem;
      display: inline-flex;
      align-items: center;
      gap: 0.22rem;
    }

    .exp-body {
      padding: 0.85rem 0.95rem 0.95rem;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
    }
    .exp-title-zh {
      font-size: 1.02rem;
      font-weight: 800;
      color: var(--green);
      line-height: 1.35;
    }
    .exp-title-en {
      font-size: 0.8rem;
      font-weight: 600;
      color: #4a7b60;
      line-height: 1.3;
    }
    .exp-desc {
      font-size: 0.82rem;
      color: #555;
      margin-top: 0.15rem;
      line-height: 1.5;
    }
    .exp-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
      margin-top: 0.3rem;
    }
    .exp-tag {
      padding: 0.18rem 0.5rem;
      border-radius: 999px;
      background: #F7F5F2;
      border: 1px solid #E9C46A;
      font-size: 0.7rem;
      color: #566;
    }
    .exp-more {
      margin-top: auto;
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--accent);
      display: inline-flex;
      align-items: center;
      gap: 0.18rem;
    }

    .empty {
      margin-top: 2rem;
      font-size: 0.95rem;
      color: #777;
      text-align: center;
    }

    .footer {
      background: linear-gradient(135deg,#2D6A4F,#40916C);
      color: #fff;
      text-align: center;
      padding: 2.4rem 2rem;
    }
    .footer a {
      color: #fff;
      text-decoration: none;
      font-weight: 700;
    }
    .footer a:hover { text-decoration: underline; }

    /* å‹•ç•« */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(18px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      opacity: 0;
      transform: translateY(26px);
      transition: all 0.7s ease;
    }
    .fade-in.visible {
      opacity: 1;
      transform: translateY(0);
    }

    @media (max-width: 768px) {
      .hero {
        padding: calc(var(--header-height) + 1.6rem) 1rem 0.8rem;
      }
      .hero-title {
        font-size: 1.7rem;
      }
      .hero-sub {
        font-size: 0.9rem;
      }
      .filter-bar {
        padding: 0.45rem 0 0.4rem;
        gap: 0.5rem;
        font-size: 0.85rem;
      }
      .filter-label {
        font-size: 0.9rem;
      }
      .filter-select,
      .search-input {
        font-size: 0.8rem;
        padding: 0.26rem 0.7rem;
      }
      .search-input {
        max-width: none;
        min-width: 160px;
      }
      .page {
        padding: 1.6rem 1rem 2.4rem;
      }
      .back-to-top {
        right: 16px;
        bottom: 16px;
        width: 48px;
        height: 48px;
        font-size: 1.2rem;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="brand">
      <a href="index.html">
        <div class="brand-en">LOCAL FRIENDS TAIWAN</div>
        <div class="brand-zh">å°ç£åœ¨åœ°é€£ç·š</div>
      </a>
    </div>
    <nav class="main-nav" id="mainNav">
      <a href="experiences.html" class="active"><span class="en">Experiences</span><span class="zh">é«”é©—åˆ—è¡¨</span></a>
      <a href="about.html"><span class="en">About</span><span class="zh">é—œæ–¼æˆ‘å€‘</span></a>
      <a href="faq.html"><span class="en">FAQ</span><span class="zh">å¸¸è¦‹å•é¡Œ</span></a>
      <a href="hosts.html"><span class="en">For Hosts</span><span class="zh">æˆç‚ºåœ¨åœ°æœ‹å‹</span></a>
      <a href="notes.html"><span class="en">Trail Notes</span><span class="zh">æ¢è·¯ç­†è¨˜</span></a>
      <a href="contact.html"><span class="en">Contact</span><span class="zh">è¯ç¹«æˆ‘å€‘</span></a>
    </nav>
    <button class="nav-toggle" id="navToggle" aria-label="åˆ‡æ›å°è¦½é¸å–®">â˜°</button>
  </header>

  <!-- Back to top -->
  <button class="back-to-top" onclick="scrollToTop()">â†‘</button>

  <!-- Hero + Filter -->
  <section class="hero">
    <div class="hero-inner fade-in">
      <h1 class="hero-title">Experiences é«”é©—åˆ—è¡¨</h1>
      <p class="hero-sub">
        Curated, community-rooted experiences hosted by real people in Taiwan.
        No packaged tours, no scripts â€” just local friends sharing their world.
      </p>

      <div class="filter-bar">
        <span class="filter-label">Filter / Searchï¼š</span>
        <select id="regionFilter" class="filter-select">
          <option value="">All Regions</option>
        </select>
        <select id="categoryFilter" class="filter-select">
          <option value="">All Categories</option>
        </select>
        <input id="searchInput" class="search-input" type="search"
               placeholder="Search by name / keyword æœå°‹é—œéµå­—">
      </div>
    </div>
  </section>

  <!-- Experiences list -->
  <main class="page fade-in">
    <div id="cards" class="cards-grid"></div>
    <div id="emptyState" class="empty" style="display:none;">
      æ‰¾ä¸åˆ°ç¬¦åˆæ¢ä»¶çš„é«”é©—ã€‚<br>
      No experiences match your current filters.
    </div>
  </main>

  <!-- Footer -->
  <footer class="footer">
    <p style="font-size:1.2rem;margin-bottom:0.6rem;"><strong>Local Friends Taiwan å°ç£åœ¨åœ°é€£ç·š</strong></p>
    <p>Your local friend in Taiwan | ç•¶ä½ éœ€è¦ä¸€ä½å°ç£åœ¨åœ°çš„æœ‹å‹</p>
    <p style="margin-top:1.2rem;opacity:0.9;font-size:0.95rem;">
      Â© 2025 Local Friends Taiwan. Independent Information Platform.
    </p>
  </footer>

  <script>
    const SHEET_ID  = '1GD4gg3sGIfX7KGrJkYCL10wzvwZh5FMWQPGd9NVTQyc';
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:csv`;

    let experiences = [];

    document.addEventListener('DOMContentLoaded', () => {
      // Nav toggle (mobile)
      const navToggle = document.getElementById('navToggle');
      const mainNav = document.getElementById('mainNav');
      if (navToggle && mainNav) {
        navToggle.addEventListener('click', () => {
          const isOpen = mainNav.classList.toggle('open');
          navToggle.classList.toggle('open', isOpen);
        });
        mainNav.querySelectorAll('a').forEach(link => {
          link.addEventListener('click', () => {
            if (mainNav.classList.contains('open')) {
              mainNav.classList.remove('open');
              navToggle.classList.remove('open');
            }
          });
        });
      }

      // æ·¡å…¥å‹•ç•«ï¼ˆèˆ‡ about/notes ä¸€è‡´ï¼‰
      const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) entry.target.classList.add('visible');
        });
      }, { threshold: 0.12, rootMargin: '0px 0px -60px 0px' });

      document.querySelectorAll('.fade-in').forEach((el, i) => {
        el.style.transitionDelay = `${i * 0.06}s`;
        observer.observe(el);
      });

      loadExperiences();
    });

    async function loadExperiences(){
      try{
        const resp = await fetch(SHEET_URL);
        const txt = await resp.text();
        const rows = parseCSV(txt);
        const headers = rows[0];
        const data = rows.slice(1);

        experiences = data.map(r => {
          const o = {};
          headers.forEach((h, i) => o[h] = r[i] || '');
          return o;
        }).filter(isPublished);

        buildFilters(experiences);
        renderCards();
      }catch(err){
        console.error(err);
        const cards = document.getElementById('cards');
        cards.innerHTML = `<div class="empty">âš ï¸ ç„¡æ³•è¼‰å…¥é«”é©—åˆ—è¡¨ Error loading experiences.</div>`;
      }
    }

    // åªé¡¯ç¤º Status æ¨™è¨˜ç‚ºã€Œå·²ç™¼ä½ˆ / å·²ç™¼å¸ƒ / publishedã€çš„é«”é©—
    function isPublished(o){
      const raw = (o['Status'] || o['status'] || '').toString().trim();
      if (!raw) return false;
      return raw === 'å·²ç™¼ä½ˆ' || raw === 'å·²ç™¼å¸ƒ' || raw.toLowerCase() === 'published';
    }

    function parseCSV(csv){
      const lines = csv.split('\n');
      return lines.map(line=>{
        const values=[];
        let cur=''; let inQ=false;
        for(const ch of line){
          if(ch==='"'){
            inQ = !inQ;
          } else if(ch===',' && !inQ){
            values.push(cur.trim());
            cur='';
          } else{
            cur+=ch;
          }
        }
        values.push(cur.trim());
        return values;
      });
    }

    function buildFilters(list){
      const regionSet = new Set();
      const catSet = new Set();
      list.forEach(exp=>{
        if(exp['åœ°å€']) regionSet.add(exp['åœ°å€'].trim());
        if(exp['ä¸»è¦åˆ†é¡']) catSet.add(exp['ä¸»è¦åˆ†é¡'].trim());
      });

      const regionSel = document.getElementById('regionFilter');
      const catSel = document.getElementById('categoryFilter');
      regionSet.forEach(v=>{
        const opt=document.createElement('option');
        opt.value=v; opt.textContent=v;
        regionSel.appendChild(opt);
      });
      catSet.forEach(v=>{
        const opt=document.createElement('option');
        opt.value=v; opt.textContent=v;
        catSel.appendChild(opt);
      });

      regionSel.addEventListener('change', renderCards);
      catSel.addEventListener('change', renderCards);
      document.getElementById('searchInput').addEventListener('input', renderCards);
    }

    function getCover(exp){
      const raw = (exp['å°é¢åœ–é€£çµ'] || exp['ç…§ç‰‡é›†'] || exp['åœ–ç‰‡'] || '').replace(/ï¼Œ/g, ',');
      const links = raw.split(/[,\s]+/).map(s=>s.trim()).filter(Boolean);
      return links[0] || '';
    }

    function renderCards(){
      const cards = document.getElementById('cards');
      const empty = document.getElementById('emptyState');
      cards.innerHTML = '';

      const region = document.getElementById('regionFilter').value;
      const cat = document.getElementById('categoryFilter').value;
      const q = document.getElementById('searchInput').value.trim().toLowerCase();

      const filtered = experiences.filter(exp=>{
        if(region && (exp['åœ°å€']||'').trim() !== region) return false;
        if(cat && (exp['ä¸»è¦åˆ†é¡']||'').trim() !== cat) return false;

        if(q){
          const text = [
            exp['é«”é©—åç¨±(ä¸­)'], exp['é«”é©—åç¨±(è‹±)'],
            exp['ä¸€å¥è©±æè¿°(ä¸­)'], exp['ä¸€å¥è©±æè¿°(è‹±)'],
            exp['åœ°å€'], exp['ä¸»è¦åˆ†é¡'], exp['æ¨™ç±¤']
          ].join(' ').toLowerCase();
          if(!text.includes(q)) return false;
        }
        return true;
      });

      if(!filtered.length){
        empty.style.display = 'block';
        return;
      }
      empty.style.display = 'none';

      filtered.forEach(exp=>{
        const id = (exp['ID'] || '').trim();
        const url = id ? `experience-detail.html?id=${encodeURIComponent(id)}` : '#';
        const cover = getCover(exp);

        const nameZh = (exp['é«”é©—åç¨±(ä¸­)'] || '').trim();
        const nameEn = (exp['é«”é©—åç¨±(è‹±)'] || '').trim();
        const line = (exp['ä¸€å¥è©±æè¿°(ä¸­)'] || exp['ä¸€å¥è©±æè¿°(è‹±)'] || '').trim();
        const regionText = (exp['åœ°å€'] || '').trim();
        const catText = (exp['ä¸»è¦åˆ†é¡'] || '').trim();

        const card = document.createElement('a');
        card.className = 'exp-card';
        card.href = url;

        card.innerHTML = `
          <div class="exp-thumb-wrap">
            ${cover
              ? `<img src="${cover}" alt="${nameZh || nameEn || 'experience cover'}"
                       class="exp-thumb"
                       onerror="this.style.display='none';this.parentElement.style.background='#e5e5e5';">`
              : ``
            }
            ${(regionText || catText)
              ? `<div class="exp-tag-top">
                  ${regionText ? `<span>ğŸ“ ${regionText}</span>` : ``}
                  ${!regionText && catText ? `<span>${catText}</span>` : ``}
                 </div>`
              : ``}
          </div>
          <div class="exp-body">
            <div class="exp-title-zh">${nameZh || 'æœªå‘½åé«”é©— Untitled Experience'}</div>
            ${nameEn ? `<div class="exp-title-en">${nameEn}</div>` : ``}
            ${line ? `<div class="exp-desc">${line}</div>` : ``}
            <div class="exp-tags">
              ${catText ? `<span class="exp-tag">${catText}</span>` : ``}
              ${exp['æ¨™ç±¤']
                ? exp['æ¨™ç±¤'].split(/[,\sã€]+/).filter(Boolean).slice(0,3).map(t=>`<span class="exp-tag">${t}</span>`).join('')
                : ``}
            </div>
            ${id
              ? `<div class="exp-more">View details æŸ¥çœ‹é«”é©—è©³æƒ… â†’</div>`
              : ``}
          </div>
        `;
        cards.appendChild(card);
      });
    }

    // Back to top
    window.addEventListener('scroll', () => {
      const b = document.querySelector('.back-to-top');
      if (!b) return;
      if (window.pageYOffset > 300) b.classList.add('show');
      else b.classList.remove('show');
    });
    function scrollToTop(){
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }
  </script>
</body>
</html>
